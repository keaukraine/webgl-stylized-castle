class t{enterFullScreen(){document.fullscreenElement||document.documentElement.requestFullscreen({navigationUI:"hide"})}exitFullScreen(){document.exitFullscreen&&document.exitFullscreen()}addFullScreenListener(t){document.addEventListener("fullscreenchange",t,!1)}isFullScreen(){return!!document.fullscreenElement}}class e{static async load(t){return(await fetch(t)).arrayBuffer()}}class i{static load(t,e,i=e.LINEAR,n=e.LINEAR,r=!1){return new Promise(((o,s)=>{const a=e.createTexture();if(null===a)return void s("Error creating WebGL texture");const h=new Image;h.src=t,h.onload=()=>{e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),!0===r?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)),e.bindTexture(e.TEXTURE_2D,null),h&&h.src&&console.log(`Loaded texture ${t} [${h.width}x${h.height}]`),o(a)},h.onerror=()=>s("Cannot load image")}))}static async loadCubemap(t,e,i="png"){const n=e.createTexture();if(null===n)throw new Error("Error creating WebGL texture");e.bindTexture(e.TEXTURE_CUBE_MAP,n),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.NEAREST);const r=[{type:e.TEXTURE_CUBE_MAP_POSITIVE_X,suffix:`-posx.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_X,suffix:`-negx.${i}`},{type:e.TEXTURE_CUBE_MAP_POSITIVE_Y,suffix:`-posy.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,suffix:`-negy.${i}`},{type:e.TEXTURE_CUBE_MAP_POSITIVE_Z,suffix:`-posz.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,suffix:`-negz.${i}`}].map((i=>new Promise(((r,o)=>{const s=new Image;s.src=t+i.suffix,s.onload=()=>{e.bindTexture(e.TEXTURE_CUBE_MAP,n),e.texImage2D(i.type,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,s),s&&s.src&&console.log(`Loaded texture ${t}${i.suffix} [${s.width}x${s.height}]`),r()},s.onerror=()=>o("Cannot load image")}))));return await Promise.all(r),e.bindTexture(e.TEXTURE_2D,null),n}}class n{constructor(){this.numIndices=0}loadBuffer(t,e,i,n){var r=new Uint8Array(n,0,n.byteLength);t.bindBuffer(i,e),t.bufferData(i,r,t.STATIC_DRAW)}async load(t,i){const[n,r]=await Promise.all([e.load(`${t}-indices.bin`),e.load(`${t}-strides.bin`)]);console.log(`Loaded ${t}-indices.bin (${n.byteLength} bytes)`),console.log(`Loaded ${t}-strides.bin (${r.byteLength} bytes)`),this.bufferIndices=i.createBuffer(),this.loadBuffer(i,this.bufferIndices,i.ELEMENT_ARRAY_BUFFER,n),this.numIndices=n.byteLength/2/3,this.bufferStrides=i.createBuffer(),this.loadBuffer(i,this.bufferStrides,i.ARRAY_BUFFER,r)}bindBuffers(t){t.bindBuffer(t.ARRAY_BUFFER,this.bufferStrides),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.bufferIndices)}getNumIndices(){return this.numIndices}}class r{constructor(t){this.gl=t,this.vertexShaderCode="",this.fragmentShaderCode="",this.fillCode(),this.initShader()}getShader(t,e){const i=this.gl.createShader(t);if(i){if(this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))return i;console.warn(this.gl.getShaderInfoLog(i))}else console.warn("Error creating shader.")}getUniform(t){if(void 0===this.program)throw new Error("No program for shader.");const e=this.gl.getUniformLocation(this.program,t);if(null!==e)return e;throw new Error(`Cannot get uniform "${t}".`)}getAttrib(t){if(void 0===this.program)throw new Error("No program for shader.");return this.gl.getAttribLocation(this.program,t)}initShader(){const t=this.getShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderCode),e=this.getShader(this.gl.VERTEX_SHADER,this.vertexShaderCode),i=this.gl.createProgram();void 0!==t&&void 0!==e&&null!==i&&(this.gl.attachShader(i,e),this.gl.attachShader(i,t),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?console.log(this.constructor.name+": Initialised shader"):console.warn(this.constructor.name+": Could not initialise shader"),this.gl.useProgram(i),this.program=i,this.fillUniformsAttributes())}use(){this.program&&this.gl.useProgram(this.program)}deleteProgram(){this.program&&this.gl.deleteProgram(this.program)}}var o="undefined"!=typeof Float32Array?Float32Array:Array;function s(){var t=new o(16);return o!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function a(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],d=e[7],m=e[8],c=e[9],f=e[10],u=e[11],g=e[12],_=e[13],p=e[14],v=e[15],x=i[0],E=i[1],b=i[2],w=i[3];return t[0]=x*n+E*a+b*m+w*g,t[1]=x*r+E*h+b*c+w*_,t[2]=x*o+E*l+b*f+w*p,t[3]=x*s+E*d+b*u+w*v,x=i[4],E=i[5],b=i[6],w=i[7],t[4]=x*n+E*a+b*m+w*g,t[5]=x*r+E*h+b*c+w*_,t[6]=x*o+E*l+b*f+w*p,t[7]=x*s+E*d+b*u+w*v,x=i[8],E=i[9],b=i[10],w=i[11],t[8]=x*n+E*a+b*m+w*g,t[9]=x*r+E*h+b*c+w*_,t[10]=x*o+E*l+b*f+w*p,t[11]=x*s+E*d+b*u+w*v,x=i[12],E=i[13],b=i[14],w=i[15],t[12]=x*n+E*a+b*m+w*g,t[13]=x*r+E*h+b*c+w*_,t[14]=x*o+E*l+b*f+w*p,t[15]=x*s+E*d+b*u+w*v,t}function h(){var t=new o(3);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function l(t,e,i){var n=new o(3);return n[0]=t,n[1]=e,n[2]=i,n}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function d(){var t=new o(4);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}h(),function(){var t,e=(t=new o(4),o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var m;h(),l(1,0,0),l(0,1,0),d(),d(),m=new o(9),o!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[5]=0,m[6]=0,m[7]=0),m[0]=1,m[4]=1,m[8]=1,function(){var t=function(){var t=new o(2);return o!=Float32Array&&(t[0]=0,t[1]=0),t}()}();class c{constructor(t){this.gl=t,this.m_textureHandle=null,this.m_depthTextureHandle=null,this.m_framebufferHandle=null,this.m_depthbufferHandle=null}createGLData(t,e){if(this.m_width=t,this.m_height=e,null!==this.m_textureHandle&&this.m_width>0&&this.m_height>0){this.m_framebufferHandle=this.gl.createFramebuffer(),null!==this.m_textureHandle&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.m_textureHandle),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.m_framebufferHandle),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.m_textureHandle,0),this.checkGlError("FB")),null===this.m_depthTextureHandle?(this.m_depthbufferHandle=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.m_depthbufferHandle),this.checkGlError("FB - glBindRenderbuffer"),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.m_width,this.m_height),this.checkGlError("FB - glRenderbufferStorage"),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.m_depthbufferHandle),this.checkGlError("FB - glFramebufferRenderbuffer")):(this.gl.bindTexture(this.gl.TEXTURE_2D,this.m_depthTextureHandle),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.m_framebufferHandle),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.m_depthTextureHandle,0),this.checkGlError("FB depth"));const t=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);t!=this.gl.FRAMEBUFFER_COMPLETE&&console.error(`Error creating framebufer: ${t}`),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}checkGlError(t){let e;for(;(e=this.gl.getError())!==this.gl.NO_ERROR;)console.error(`${t}: glError ${e}`)}get width(){return this.m_width}set width(t){this.m_width=t}get height(){return this.m_height}set height(t){this.m_height=t}get textureHandle(){return this.m_textureHandle}set textureHandle(t){this.m_textureHandle=t}get depthbufferHandle(){return this.m_depthbufferHandle}set depthbufferHandle(t){this.m_depthbufferHandle=t}get framebufferHandle(){return this.m_framebufferHandle}set framebufferHandle(t){this.m_framebufferHandle=t}get depthTextureHandle(){return this.m_depthTextureHandle}set depthTextureHandle(t){this.m_depthTextureHandle=t}}class f extends r{fillCode(){this.vertexShaderCode="uniform mat4 view_proj_matrix;\nattribute vec4 rm_Vertex;\nattribute vec2 rm_TexCoord0;\nvarying vec2 vTextureCoord;\n\nvoid main() {\n  gl_Position = view_proj_matrix * rm_Vertex;\n  vTextureCoord = rm_TexCoord0;\n}",this.fragmentShaderCode="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D sTexture;\n\nvoid main() {\n  gl_FragColor = texture2D(sTexture, vTextureCoord);\n}"}fillUniformsAttributes(){this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_TexCoord0=this.getAttrib("rm_TexCoord0"),this.sTexture=this.getUniform("sTexture")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.enableVertexAttribArray(this.rm_TexCoord0),m.vertexAttribPointer(this.rm_Vertex,3,m.FLOAT,!1,20,0),m.vertexAttribPointer(this.rm_TexCoord0,2,m.FLOAT,!1,20,12),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("DiffuseShader glDrawElements")}}var u="undefined"!=typeof Float32Array?Float32Array:Array;function g(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function _(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function p(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function v(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],d=e[8],m=e[9],c=e[10],f=e[11],u=e[12],g=e[13],_=e[14],p=e[15],v=i*a-n*s,x=i*h-r*s,E=i*l-o*s,b=n*h-r*a,w=n*l-o*a,A=r*l-o*h,y=d*g-m*u,C=d*_-c*u,M=d*p-f*u,T=m*_-c*g,R=m*p-f*g,S=c*p-f*_,F=v*S-x*R+E*T+b*M-w*C+A*y;return F?(F=1/F,t[0]=(a*S-h*R+l*T)*F,t[1]=(r*R-n*S-o*T)*F,t[2]=(g*A-_*w+p*b)*F,t[3]=(c*w-m*A-f*b)*F,t[4]=(h*M-s*S-l*C)*F,t[5]=(i*S-r*M+o*C)*F,t[6]=(_*E-u*A-p*x)*F,t[7]=(d*A-c*E+f*x)*F,t[8]=(s*R-a*M+l*y)*F,t[9]=(n*M-i*R-o*y)*F,t[10]=(u*w-g*E+p*v)*F,t[11]=(m*E-d*w-f*v)*F,t[12]=(a*C-s*T-h*y)*F,t[13]=(i*T-n*C+r*y)*F,t[14]=(g*x-u*b-_*v)*F,t[15]=(d*b-m*x+c*v)*F,t):null}function x(t,e,i){var n,r,o,s,a,h,l,d,m,c,f,u,g=i[0],_=i[1],p=i[2];return e===t?(t[12]=e[0]*g+e[4]*_+e[8]*p+e[12],t[13]=e[1]*g+e[5]*_+e[9]*p+e[13],t[14]=e[2]*g+e[6]*_+e[10]*p+e[14],t[15]=e[3]*g+e[7]*_+e[11]*p+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],d=e[7],m=e[8],c=e[9],f=e[10],u=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=l,t[7]=d,t[8]=m,t[9]=c,t[10]=f,t[11]=u,t[12]=n*g+a*_+m*p+e[12],t[13]=r*g+h*_+c*p+e[13],t[14]=o*g+l*_+f*p+e[14],t[15]=s*g+d*_+u*p+e[15]),t}function E(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],h=e[7],l=e[8],d=e[9],m=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+l*n,t[5]=s*r+d*n,t[6]=a*r+m*n,t[7]=h*r+c*n,t[8]=l*r-o*n,t[9]=d*r-s*n,t[10]=m*r-a*n,t[11]=c*r-h*n,t}function b(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],l=e[8],d=e[9],m=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-l*n,t[1]=s*r-d*n,t[2]=a*r-m*n,t[3]=h*r-c*n,t[8]=o*n+l*r,t[9]=s*n+d*r,t[10]=a*n+m*r,t[11]=h*n+c*r,t}function w(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],l=e[4],d=e[5],m=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+l*n,t[1]=s*r+d*n,t[2]=a*r+m*n,t[3]=h*r+c*n,t[4]=l*r-o*n,t[5]=d*r-s*n,t[6]=m*r-a*n,t[7]=c*r-h*n,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var A,y=function(t,e,i,n,r,o,s){var a=1/(e-i),h=1/(n-r),l=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*h,t[14]=(s+o)*l,t[15]=1,t};function C(t,e,i,n){var r,o,s,a,h,l,d,m,c,f,u=e[0],g=e[1],_=e[2],v=n[0],x=n[1],E=n[2],b=i[0],w=i[1],A=i[2];return Math.abs(u-b)<1e-6&&Math.abs(g-w)<1e-6&&Math.abs(_-A)<1e-6?p(t):(d=u-b,m=g-w,c=_-A,r=x*(c*=f=1/Math.hypot(d,m,c))-E*(m*=f),o=E*(d*=f)-v*c,s=v*m-x*d,(f=Math.hypot(r,o,s))?(r*=f=1/f,o*=f,s*=f):(r=0,o=0,s=0),a=m*s-c*o,h=c*r-d*s,l=d*o-m*r,(f=Math.hypot(a,h,l))?(a*=f=1/f,h*=f,l*=f):(a=0,h=0,l=0),t[0]=r,t[1]=a,t[2]=d,t[3]=0,t[4]=o,t[5]=h,t[6]=m,t[7]=0,t[8]=s,t[9]=l,t[10]=c,t[11]=0,t[12]=-(r*u+o*g+s*_),t[13]=-(a*u+h*g+l*_),t[14]=-(d*u+m*g+c*_),t[15]=1,t)}function M(){var t=new u(3);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function T(t,e,i){var n=new u(3);return n[0]=t,n[1]=e,n[2]=i,n}!function(){var t=M()}(),function(t){t[t.Rotating=0]="Rotating",t[t.Random=1]="Random",t[t.Orbiting=2]="Orbiting",t[t.FPS=3]="FPS"}(A||(A={}));const R="\nout float vFogAmount;\nuniform float fogDistance;\nuniform float fogStartDistance;\n",S="\nvFogAmount = clamp((length(gl_Position) - fogStartDistance) / fogDistance, 0.0, 1.0);\n",F="\nin float vFogAmount;\nuniform vec4 fogColor;\n",P="\nfragColor = mix(fragColor, fogColor, vFogAmount);\n",D="\nuniform vec3 lightVector;\nuniform mat4 projectionMatrix;\n// uniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 lightMatrix;\nuniform float shadowBrightnessVS;\n\nout highp vec4 vPosition;\nout float vLamb;\n\nconst mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);\n// const float BIAS = 0.2; // adjustable, for 4096 shadowmap\n// const float BIAS = 0.4; // adjustable, for 2048 shadowmap\nconst float BIAS = 0.1; // adjustable, for 2500 shadowmap\n",O="\nin highp vec4 vPosition;\nuniform sampler2D sDepth;\nuniform highp float texelSize;\nuniform float shadowBrightnessFS;\nuniform float pcfBiasCorrection;\nin float vLamb;\n\n// const float PCF_BIAS_CORRECTION = 0.001; // for 4096 shadowmap\n// const float PCF_BIAS_CORRECTION = 0.002; // for 2048 shadowmap\nconst float PCF_BIAS_CORRECTION = 0.0008; // larger values (as above) cause peterpanning\n".replace(/sampler2D/g,"mediump sampler2DShadow");function I(t){return`\n    float colorCoeff = 0.; // 0 = fully shadowed, 1 = out of shadow\n    depth.z -= pcfBiasCorrection;\n    if (${t}) { // unfiltered\n        colorCoeff = texture(sDepth, depth);\n    } else { // 5 taps PCF\n        colorCoeff = texture(sDepth, depth);\n        colorCoeff += texture(sDepth, vec3(depth.x-texelSize, depth.y-texelSize, depth.z));\n        colorCoeff += texture(sDepth, vec3(depth.x-texelSize, depth.y+texelSize, depth.z));\n        colorCoeff += texture(sDepth, vec3(depth.x+texelSize, depth.y-texelSize, depth.z));\n        colorCoeff += texture(sDepth, vec3(depth.x+texelSize, depth.y+texelSize, depth.z));\n        const float SAMPLES_COUNT = 5.0;\n        colorCoeff /= SAMPLES_COUNT;\n    }\n    `}class L extends r{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec3 colors[32];\n\n            out vec4 vDiffuseColor;\n            out float vLightCoeff;\n\n            in vec4 rm_Vertex;\n            in uint rm_Color;\n            in vec3 rm_Normal;\n\n            const float ONE = 1.0;\n            const float ZERO = 0.0;\n\n            // Shadowmaps stuff\n            ${D}\n\n            // Fog stuff\n            ${R}\n\n            void main(void)\n            {\n                vec4 pos = model_matrix * rm_Vertex;\n\n                gl_Position = view_proj_matrix * rm_Vertex;\n\n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(rm_Normal, ZERO);\n                vec3 vNormal = normalize(view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(ZERO, dot(vNormal, normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n\n                float angle = rm_Normal.z;\n\n                vec4 color = vec4(colors[rm_Color], ONE);\n\n                vDiffuseColor = color;\n                vLightCoeff = d * diffuseCoef;\n\n                // Shadowmap stuff\n                vec3 LightVec = normalize(lightVector);\n                vec3 worldNormal = normalize(mat3(modelMatrix) * rm_Normal);\n                float lamb = (dot(worldNormal, LightVec)); // range is -1...1 https://chortle.ccsu.edu/vectorlessons/vch09/vch09_6.html\n                vec4 vertex = rm_Vertex;\n                vertex.xyz += worldNormal * BIAS * (ONE - lamb);\n                vPosition = ScaleMatrix * projectionMatrix * lightMatrix * modelMatrix * vertex;\n\n                // Fog stuff\n                ${S}\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n\n            in mediump vec4 vDiffuseColor;\n            in mediump float vLightCoeff;\n            out vec4 fragColor;\n\n            uniform mediump vec4 diffuse;\n            uniform mediump vec4 ambient;\n\n            // Shadowmaps stuff\n            ${O}\n\n            // Fog stuff\n            ${F}\n\n            void main(void)\n            {\n                highp vec3 depth = vPosition.xyz / vPosition.w;\n\n                ${I("vFogAmount > 0.1")}\n\n                colorCoeff = clamp(colorCoeff, shadowBrightnessFS, 1.); // clamp to limit shadow intensity\n                float lightCoeff = min(colorCoeff, vLightCoeff); // this mixes Lambert and shadow coefficients\n                fragColor = vDiffuseColor * mix(ambient, diffuse, lightCoeff);\n\n                // Fog stuff\n                ${P}\n            }`}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_Normal=this.getAttrib("rm_Normal"),this.rm_Color=this.getAttrib("rm_Color"),this.view_matrix=this.getUniform("view_matrix"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.ambient=this.getUniform("ambient"),this.diffuse=this.getUniform("diffuse"),this.lightDir=this.getUniform("lightDir"),this.diffuseCoef=this.getUniform("diffuseCoef"),this.diffuseExponent=this.getUniform("diffuseExponent"),this.colors=this.getUniform("colors"),this.sDepth=this.getUniform("sDepth"),this.projectionMatrix=this.getUniform("projectionMatrix"),this.modelMatrix=this.getUniform("modelMatrix"),this.lightMatrix=this.getUniform("lightMatrix"),this.texelSize=this.getUniform("texelSize"),this.lightVector=this.getUniform("lightVector"),this.shadowBrightnessFS=this.getUniform("shadowBrightnessFS"),this.pcfBiasCorrection=this.getUniform("pcfBiasCorrection"),this.fogColor=this.getUniform("fogColor"),this.fogStartDistance=this.getUniform("fogStartDistance"),this.fogDistance=this.getUniform("fogDistance")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.rm_Normal||void 0===this.rm_Color||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.enableVertexAttribArray(this.rm_Color),m.enableVertexAttribArray(this.rm_Normal),m.vertexAttribPointer(this.rm_Vertex,3,m.HALF_FLOAT,!1,12,0),m.vertexAttribIPointer(this.rm_Color,1,m.UNSIGNED_BYTE,12,6),m.vertexAttribPointer(this.rm_Normal,3,m.BYTE,!0,12,7),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.uniformMatrix4fv(this.view_matrix,!1,t.getViewMatrix()),m.uniformMatrix4fv(this.model_matrix,!1,t.getModelMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("VertexColorSmShader glDrawElements")}}class N extends r{fillCode(){this.vertexShaderCode="#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n            in vec4 rm_Vertex;\n\n            void main(void) {\n                gl_Position = view_proj_matrix * rm_Vertex;\n            }",this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n\n            void main(void) {\n            }"}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.view_proj_matrix=this.getUniform("view_proj_matrix")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.vertexAttribPointer(this.rm_Vertex,3,m.HALF_FLOAT,!1,12,0),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("VertexColorSmShader glDrawElements")}}class U extends r{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec4 color;\n            uniform float time;\n\n            out vec4 vDiffuseColor;\n            out float vLightCoeff;\n\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            const float ONE = 1.0;\n            const float ZERO = 0.0;\n\n            uniform float amplitude;\n            uniform float waves;\n\n            // Shadowmaps stuff\n            ${D}\n\n            // Fog stuff\n            ${R}\n\n            const float NORMAL_BEND_COEFF = 0.6;\n\n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n                vec3 animatedNormal = rm_Normal;\n\n                float a = sin(time + rm_Vertex.y * waves);\n                a *= amplitude;\n                a *= vertex.y;\n                vertex.x += a;\n\n                float n = cos(time + rm_Vertex.y * waves) * NORMAL_BEND_COEFF;\n                n *= vertex.y;\n                animatedNormal.y = -n * animatedNormal.x;\n                animatedNormal = normalize(animatedNormal);\n\n                vec4 pos = model_matrix * vertex;\n\n                gl_Position = view_proj_matrix * vertex;\n\n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                vec4 normal = model_matrix * vec4(animatedNormal, ZERO);\n                vec3 vNormal = normalize(view_matrix * normal).xyz; // w component of animatedNormal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(ZERO, dot(vNormal, normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n\n                vDiffuseColor = color;\n                vLightCoeff = d * diffuseCoef;\n\n                // Shadowmap stuff\n                vec3 LightVec = normalize(lightVector);\n                vec3 worldNormal = normalize(mat3(modelMatrix) * animatedNormal);\n                float lamb = (dot(worldNormal, LightVec)); // range is -1...1 https://chortle.ccsu.edu/vectorlessons/vch09/vch09_6.html\n                vertex.xyz += worldNormal * BIAS * (ONE - lamb);\n                vPosition = ScaleMatrix * projectionMatrix * lightMatrix * modelMatrix * vertex;\n\n                // Fog stuff\n                ${S}\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n\n            in vec2 vTexCoord;\n            in vec4 vDiffuseColor;\n            in float vLightCoeff;\n            out vec4 fragColor;\n\n            uniform mediump vec4 diffuse;\n            uniform mediump vec4 ambient;\n\n            // Shadowmaps stuff\n            ${O}\n\n            // Fog stuff\n            ${F}\n\n            void main(void)\n            {\n                highp vec3 depth = vPosition.xyz / vPosition.w;\n                ${I("vFogAmount > 0.1")}\n                colorCoeff = clamp(colorCoeff, shadowBrightnessFS, 1.); // clamp to limit shadow intensity\n                float lightCoeff = min(colorCoeff, vLightCoeff); // this mixes Lambert and shadow coefficients\n                fragColor = vDiffuseColor * mix(ambient, diffuse, lightCoeff);\n\n                // Fog stuff\n                ${P}\n            }`}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_Normal=this.getAttrib("rm_Normal"),this.view_matrix=this.getUniform("view_matrix"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.ambient=this.getUniform("ambient"),this.diffuse=this.getUniform("diffuse"),this.lightDir=this.getUniform("lightDir"),this.diffuseCoef=this.getUniform("diffuseCoef"),this.diffuseExponent=this.getUniform("diffuseExponent"),this.color=this.getUniform("color"),this.time=this.getUniform("time"),this.amplitude=this.getUniform("amplitude"),this.waves=this.getUniform("waves"),this.sDepth=this.getUniform("sDepth"),this.projectionMatrix=this.getUniform("projectionMatrix"),this.modelMatrix=this.getUniform("modelMatrix"),this.lightMatrix=this.getUniform("lightMatrix"),this.texelSize=this.getUniform("texelSize"),this.lightVector=this.getUniform("lightVector"),this.shadowBrightnessFS=this.getUniform("shadowBrightnessFS"),this.pcfBiasCorrection=this.getUniform("pcfBiasCorrection"),this.fogColor=this.getUniform("fogColor"),this.fogStartDistance=this.getUniform("fogStartDistance"),this.fogDistance=this.getUniform("fogDistance")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.enableVertexAttribArray(this.rm_Normal),m.vertexAttribPointer(this.rm_Vertex,3,m.HALF_FLOAT,!1,12,0),m.vertexAttribPointer(this.rm_Normal,3,m.BYTE,!0,12,6),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.uniformMatrix4fv(this.view_matrix,!1,t.getViewMatrix()),m.uniformMatrix4fv(this.model_matrix,!1,t.getModelMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("VertexColorSmShader glDrawElements")}}class V extends r{fillCode(){this.vertexShaderCode="#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n            uniform float time;\n            in vec4 rm_Vertex;\n\n            uniform float amplitude;// = 0.2;\n            uniform float waves;// = 5.;\n\n            void main(void) {\n                vec4 vertex = rm_Vertex;\n                float a = sin(time + rm_Vertex.y * waves);\n                a *= amplitude;\n                a *= vertex.y;\n                vertex.x += a;\n\n                gl_Position = view_proj_matrix * vertex;\n            }",this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n\n            void main(void) {\n            }"}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.time=this.getUniform("time"),this.amplitude=this.getUniform("amplitude"),this.waves=this.getUniform("waves")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.vertexAttribPointer(this.rm_Vertex,3,m.HALF_FLOAT,!1,12,0),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("VertexColorSmShader glDrawElements")}}const B="\n    /** https://www.neilmendoza.com/glsl-rotation-about-an-arbitrary-axis/ */\n    mat4 rotationMatrix(vec3 axis, float angle)\n    {\n        // axis = normalize(axis);\n        float s = sin(angle);\n        float c = cos(angle);\n        float oc = 1.0 - c;\n\n        return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                    oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                    oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                    0.0,                                0.0,                                0.0,                                1.0);\n    }\n\n    /** Optimized version to rotate only around X axis */\n    mat4 rotationAroundX(float angle)\n    {\n        float s = sin(angle);\n        float c = cos(angle);\n\n        return mat4(1.0, 0.0, 0.0, 0.0,\n                    0.0, c,   -s,  0.0,\n                    0.0, s,   c,   0.0,\n                    0.0, 0.0, 0.0, 1.0);\n    }\n\n    /** Optimized version to rotate only around Y axis */\n    mat4 rotationAroundY(float angle)\n    {\n        float s = sin(angle);\n        float c = cos(angle);\n        // float oc = 1.0 - c;\n\n        return mat4(c,   0.0, s,   0.0,\n                    0.0, 1.0, 0.0, 0.0,\n                    -s,  0.0, c,   0.0,\n                    0.0, 0.0, 0.0, 1.0);\n    }\n\n    /** Optimized version to rotate only around Z axis */\n    mat4 rotationAroundZ(float angle)\n    {\n        float s = sin(angle);\n        float c = cos(angle);\n\n        return mat4(c,  -s,   0.0, 0.0,\n                    s,   c,   0.0, 0.0,\n                    0.0, 0.0, 1.0, 0.0,\n                    0.0, 0.0, 0.0, 1.0);\n    }\n    ";class k extends r{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec3 colors[32];\n\n            out float vLightCoeff;\n            out vec2 vTexCoord;\n            out vec3 vVertex;\n\n            in vec4 rm_Vertex;\n            in vec2 rm_TexCoord;\n            in vec3 rm_Normal;\n\n            const float ONE = 1.0;\n            const float ZERO = 0.0;\n\n            // Shadowmaps stuff\n            ${D}\n\n            // Fog stuff\n            ${R}\n\n            // Animation\n            ${B}\n            ${k.UNIFORMS_CONSTANTS}\n\n            void main(void)\n            {\n                vTexCoord = rm_TexCoord;\n                vVertex = rm_Vertex.xyz;\n\n                vec4 vertex = rm_Vertex;\n                vec4 normal = vec4(rm_Normal, ZERO);\n\n                if (gl_VertexID < 36) { // body\n                } else if (gl_VertexID < 72) { // head\n                    mat4 matHeadRotation = rotationAroundZ(headRotationZ);\n                    normal *= matHeadRotation;\n                    vertex *= matHeadRotation;\n                } else if (gl_VertexID < 108) { // left arm\n                    mat4 matLeftArmRotation = rotationAroundY(armRotations.x);\n                    normal *= matLeftArmRotation;\n                    vertex.z += ARM_PIVOT;\n                    vertex *= matLeftArmRotation;\n                    vertex.z -= ARM_PIVOT;\n                } else { // right arm\n                    mat4 matRightArmRotation = rotationAroundY(armRotations.y);\n                    normal *= matRightArmRotation;\n                    vertex.z += ARM_PIVOT;\n                    vertex *= matRightArmRotation;\n                    vertex.z -= ARM_PIVOT;\n                }\n\n                gl_Position = view_proj_matrix * vertex;\n\n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                normal = model_matrix * normal;\n                vec3 vNormal = normalize(view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(ZERO, dot(vNormal, normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n\n                float angle = rm_Normal.z;\n\n                vLightCoeff = d * diffuseCoef;\n\n                // Shadowmap stuff\n                vec3 LightVec = normalize(lightVector);\n                vec3 worldNormal = normalize(mat3(modelMatrix) * rm_Normal);\n                float lamb = (dot(worldNormal, LightVec)); // range is -1...1 https://chortle.ccsu.edu/vectorlessons/vch09/vch09_6.html\n                vertex.xyz += worldNormal * BIAS * (ONE - lamb);\n                vPosition = ScaleMatrix * projectionMatrix * lightMatrix * modelMatrix * vertex;\n\n                // Fog stuff\n                ${S}\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n\n            in vec2 vTexCoord;\n            in vec3 vVertex;\n            in float vLightCoeff;\n            out vec4 fragColor;\n\n            uniform mediump vec4 diffuse;\n            uniform mediump vec4 ambient;\n            uniform sampler2D sTexture;\n\n            // Shadowmaps stuff\n            ${O}\n\n            // Fog stuff\n            ${F}\n\n            void main(void)\n            {\n                highp vec3 depth = vPosition.xyz / vPosition.w;\n                ${I("vFogAmount > 0.1")}\n                colorCoeff = clamp(colorCoeff, shadowBrightnessFS, 1.); // clamp to limit shadow intensity\n                float lightCoeff = min(colorCoeff, vLightCoeff); // this mixes Lambert and shadow coefficients\n                fragColor = texture(sTexture, vTexCoord) * mix(ambient, diffuse, lightCoeff);\n\n                // Fog stuff\n                ${P}\n            }`}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_Normal=this.getAttrib("rm_Normal"),this.rm_TexCoord=this.getAttrib("rm_TexCoord"),this.view_matrix=this.getUniform("view_matrix"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.ambient=this.getUniform("ambient"),this.diffuse=this.getUniform("diffuse"),this.lightDir=this.getUniform("lightDir"),this.diffuseCoef=this.getUniform("diffuseCoef"),this.diffuseExponent=this.getUniform("diffuseExponent"),this.sTexture=this.getUniform("sTexture"),this.headRotationZ=this.getUniform("headRotationZ"),this.armRotations=this.getUniform("armRotations"),this.sDepth=this.getUniform("sDepth"),this.projectionMatrix=this.getUniform("projectionMatrix"),this.modelMatrix=this.getUniform("modelMatrix"),this.lightMatrix=this.getUniform("lightMatrix"),this.texelSize=this.getUniform("texelSize"),this.lightVector=this.getUniform("lightVector"),this.shadowBrightnessFS=this.getUniform("shadowBrightnessFS"),this.pcfBiasCorrection=this.getUniform("pcfBiasCorrection"),this.fogColor=this.getUniform("fogColor"),this.fogStartDistance=this.getUniform("fogStartDistance"),this.fogDistance=this.getUniform("fogDistance")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.rm_Normal||void 0===this.rm_TexCoord||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.enableVertexAttribArray(this.rm_TexCoord),m.enableVertexAttribArray(this.rm_Normal),m.vertexAttribPointer(this.rm_Vertex,3,m.FLOAT,!1,32,0),m.vertexAttribPointer(this.rm_TexCoord,2,m.FLOAT,!1,32,12),m.vertexAttribPointer(this.rm_Normal,3,m.FLOAT,!0,32,20),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.uniformMatrix4fv(this.view_matrix,!1,t.getViewMatrix()),m.uniformMatrix4fv(this.model_matrix,!1,t.getModelMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("VertexColorSmShader glDrawElements")}}k.UNIFORMS_CONSTANTS="\n    uniform float headRotationZ;\n    uniform vec2 armRotations; // x - left arm, y - right arm\n    const float ARM_PIVOT = -2.25;\n    ";class H extends r{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n            in vec4 rm_Vertex;\n\n            // Animation\n            ${B}\n            ${k.UNIFORMS_CONSTANTS}\n\n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n\n                if (gl_VertexID < 36) { // body\n                } else if (gl_VertexID < 72) { // head\n                    mat4 matHeadRotation = rotationAroundZ(headRotationZ);\n                    vertex *= matHeadRotation;\n                } else if (gl_VertexID < 108) { // left arm\n                    mat4 matLeftArmRotation = rotationAroundY(armRotations.x);\n                    vertex.z += ARM_PIVOT;\n                    vertex *= matLeftArmRotation;\n                    vertex.z -= ARM_PIVOT;\n                } else { // right arm\n                    mat4 matRightArmRotation = rotationAroundY(armRotations.y);\n                    vertex.z += ARM_PIVOT;\n                    vertex *= matRightArmRotation;\n                    vertex.z -= ARM_PIVOT;\n                }\n\n                gl_Position = view_proj_matrix * vertex;\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n\n            void main(void) {\n            }"}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.headRotationZ=this.getUniform("headRotationZ"),this.armRotations=this.getUniform("armRotations")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.vertexAttribPointer(this.rm_Vertex,3,m.FLOAT,!1,32,0),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("VertexColorSmShader glDrawElements")}}class z extends r{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform vec4 lightDir;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n            uniform float diffuseCoef;\n            uniform float diffuseExponent;\n\n            uniform vec3 colors[32];\n\n            out float vLightCoeff;\n            out vec2 vTexCoord;\n            out vec3 vVertex;\n\n            in vec4 rm_Vertex;\n            in vec2 rm_TexCoord;\n            in vec3 rm_Normal;\n\n            const float ONE = 1.0;\n            const float ZERO = 0.0;\n\n            // Shadowmaps stuff\n            ${D}\n\n            // Fog stuff\n            ${R}\n\n            // Animation\n            ${B}\n            ${z.UNIFORMS_CONSTANTS}\n\n            void main(void)\n            {\n                vTexCoord = rm_TexCoord;\n                vVertex = rm_Vertex.xyz;\n\n                vec4 vertex = rm_Vertex;\n                vec4 normal = vec4(rm_Normal, ZERO);\n\n                if (gl_VertexID > 44 && gl_VertexID < 81) { // left wing\n                    mat4 matLeftRotation = rotationAroundX(-wingsRotation);\n                    normal *= matLeftRotation;\n                    vertex.y -= WING_PIVOT;\n                    vertex *= matLeftRotation;\n                    vertex.y += WING_PIVOT;\n                } else if (gl_VertexID > 149 && gl_VertexID < 186) { // right wing\n                    mat4 matRightRotation = rotationAroundX(wingsRotation);\n                    normal *= matRightRotation;\n                    vertex.y += WING_PIVOT;\n                    vertex *= matRightRotation;\n                    vertex.y -= WING_PIVOT;\n                }\n\n                gl_Position = view_proj_matrix * vertex;\n\n                vec3 vLightVec = (view_matrix * lightDir).xyz;\n                normal = model_matrix * normal;\n                vec3 vNormal = normalize(view_matrix * normal).xyz; // w component of rm_Normal might be ignored, and implicitly converted to vec4 in uniform declaration\n                float d = pow(max(ZERO, dot(vNormal, normalize(vLightVec))), diffuseExponent); // redundant normalize() ??\n\n                float angle = rm_Normal.z;\n\n                vLightCoeff = d * diffuseCoef;\n\n                // Shadowmap stuff\n                vec3 LightVec = normalize(lightVector);\n                vec3 worldNormal = normalize(mat3(modelMatrix) * rm_Normal);\n                float lamb = (dot(worldNormal, LightVec)); // range is -1...1 https://chortle.ccsu.edu/vectorlessons/vch09/vch09_6.html\n                vertex.xyz += worldNormal * BIAS * (ONE - lamb);\n                vPosition = ScaleMatrix * projectionMatrix * lightMatrix * modelMatrix * vertex;\n\n                // Fog stuff\n                ${S}\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n\n            in vec2 vTexCoord;\n            in vec3 vVertex;\n            in float vLightCoeff;\n            out vec4 fragColor;\n\n            uniform mediump vec4 diffuse;\n            uniform mediump vec4 ambient;\n            uniform sampler2D sTexture;\n\n            // Shadowmaps stuff\n            ${O}\n\n            // Fog stuff\n            ${F}\n\n            void main(void)\n            {\n                highp vec3 depth = vPosition.xyz / vPosition.w;\n                ${I("vFogAmount > 0.1")}\n                colorCoeff = clamp(colorCoeff, shadowBrightnessFS, 1.); // clamp to limit shadow intensity\n                float lightCoeff = min(colorCoeff, vLightCoeff); // this mixes Lambert and shadow coefficients\n                fragColor = texture(sTexture, vTexCoord) * mix(ambient, diffuse, lightCoeff);\n\n                // Fog stuff\n                ${P}\n            }`}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_Normal=this.getAttrib("rm_Normal"),this.rm_TexCoord=this.getAttrib("rm_TexCoord"),this.view_matrix=this.getUniform("view_matrix"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.ambient=this.getUniform("ambient"),this.diffuse=this.getUniform("diffuse"),this.lightDir=this.getUniform("lightDir"),this.diffuseCoef=this.getUniform("diffuseCoef"),this.diffuseExponent=this.getUniform("diffuseExponent"),this.sTexture=this.getUniform("sTexture"),this.wingsRotation=this.getUniform("wingsRotation"),this.sDepth=this.getUniform("sDepth"),this.projectionMatrix=this.getUniform("projectionMatrix"),this.modelMatrix=this.getUniform("modelMatrix"),this.lightMatrix=this.getUniform("lightMatrix"),this.texelSize=this.getUniform("texelSize"),this.lightVector=this.getUniform("lightVector"),this.shadowBrightnessFS=this.getUniform("shadowBrightnessFS"),this.pcfBiasCorrection=this.getUniform("pcfBiasCorrection"),this.fogColor=this.getUniform("fogColor"),this.fogStartDistance=this.getUniform("fogStartDistance"),this.fogDistance=this.getUniform("fogDistance")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.rm_Normal||void 0===this.rm_TexCoord||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.enableVertexAttribArray(this.rm_TexCoord),m.enableVertexAttribArray(this.rm_Normal),m.vertexAttribPointer(this.rm_Vertex,3,m.FLOAT,!1,32,0),m.vertexAttribPointer(this.rm_TexCoord,2,m.FLOAT,!1,32,12),m.vertexAttribPointer(this.rm_Normal,3,m.FLOAT,!0,32,20),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.uniformMatrix4fv(this.view_matrix,!1,t.getViewMatrix()),m.uniformMatrix4fv(this.model_matrix,!1,t.getModelMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("VertexColorSmShader glDrawElements")}}z.UNIFORMS_CONSTANTS="\n    uniform float wingsRotation;\n    const float WING_PIVOT = 6.0;\n    ";class j extends r{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n            in vec4 rm_Vertex;\n\n            // Animation\n            ${B}\n            ${z.UNIFORMS_CONSTANTS}\n\n            void main(void)\n            {\n                vec4 vertex = rm_Vertex;\n\n                if (gl_VertexID > 44 && gl_VertexID < 81) { // left wing\n                    mat4 matLeftRotation = rotationAroundX(-wingsRotation);\n                    vertex.y -= WING_PIVOT;\n                    vertex *= matLeftRotation;\n                    vertex.y += WING_PIVOT;\n                } else if (gl_VertexID > 149 && gl_VertexID < 186) { // right wing\n                    mat4 matRightRotation = rotationAroundX(wingsRotation);\n                    vertex.y += WING_PIVOT;\n                    vertex *= matRightRotation;\n                    vertex.y -= WING_PIVOT;\n                }\n\n                gl_Position = view_proj_matrix * vertex;\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n\n            void main(void) {\n            }"}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.wingsRotation=this.getUniform("wingsRotation")}drawModel(t,e,i,n,r,o,s,a,h,l,d){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix)return;const m=t.gl;e.bindBuffers(m),m.enableVertexAttribArray(this.rm_Vertex),m.vertexAttribPointer(this.rm_Vertex,3,m.FLOAT,!1,32,0),t.calculateMVPMatrix(i,n,r,o,s,a,h,l,d),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.drawElements(m.TRIANGLES,3*e.getNumIndices(),m.UNSIGNED_SHORT,0),t.checkGlError("VertexColorSmShader glDrawElements")}}class G{constructor(){this._speed=0,this.duration=0,this._minDuration=3e3,this._timer=0,this.lastTime=0,this._reverse=!1,this._cameraPosition=M(),this._cameraRotation=M(),this._matrix=g()}get cameraPosition(){return this._cameraPosition}get cameraRotation(){return this._cameraRotation}set reverse(t){this._reverse=t}set minDuration(t){this._minDuration=t}get matrix(){return this._matrix}get speed(){return this._speed}set speed(t){this._speed=t}get position(){return this._position}set position(t){this._position=t,this.duration=Math.max(this.getLength()/this.speed,this._minDuration)}get timer(){return this._timer}getLength(){if(void 0===this.position)return 0;const t=this.position.start.position,e=this.position.end.position;return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2)}iterate(t){if(0!=this.lastTime){const e=t-this.lastTime;this._timer+=e/this.duration,this._timer>1&&(this._timer=1)}this.lastTime=t,this.updateMatrix()}reset(){this._timer=0,this.updateMatrix()}updateMatrix(){if(void 0===this._position)return;const t=this._reverse?this._position.end:this._position.start,e=this._reverse?this._position.start:this._position.end;this._cameraPosition[0]=t.position[0]+this._timer*(e.position[0]-t.position[0]),this._cameraPosition[1]=t.position[1]+this._timer*(e.position[1]-t.position[1]),this._cameraPosition[2]=t.position[2]+this._timer*(e.position[2]-t.position[2]),this._cameraRotation[0]=t.rotation[0]+this._timer*(e.rotation[0]-t.rotation[0]),this._cameraRotation[1]=t.rotation[1]+this._timer*(e.rotation[1]-t.rotation[1]),this._cameraRotation[2]=t.rotation[2]+this._timer*(e.rotation[2]-t.rotation[2]),p(this.matrix),E(this.matrix,this.matrix,this._cameraRotation[0]-Math.PI/2),w(this.matrix,this.matrix,this._cameraRotation[1]),b(this.matrix,this.matrix,this._cameraRotation[2]),x(this.matrix,this.matrix,[-this._cameraPosition[0],-this._cameraPosition[1],-this._cameraPosition[2]])}}const X=new Float32Array([.173,.847,.7220001]),W=new Float32Array([.816,.58,.42,.84,.435,.305,.169,.651,.667,.571,.559,.736,.878,.271,.271,.58,.569,.769,.949,.855,.631,.173,.847,.722]),K=new Float32Array([.571,.559,.736,.403,.39,.594,1,.392,.306,.58,.569,.769,1,1,1,.698,.316,.194,.71,.701,.84,.816,.58,.42,.84,.435,.305,.485,.668,.962,.376,.376,.376,.961,.843,.733,.878,.271,.271,1,.42,.51,.949,.855,.631,.173,.847,.722,.169,.651,.667]),$=[[1,1,1],[.1,.2,.7],[.99,.42,.17],[.99,.19,.61]],Y=[.45,.25,.35,.35];class Z extends r{fillCode(){this.vertexShaderCode="#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n            uniform vec3 offset;\n            uniform vec2 dimensions; // x = length; y = width coefficient\n            uniform vec3 amplitudes; // x = 1st XY harmonic; y = 2nd XY harmonic; z = Z amplitude\n            uniform vec3 frequencies; // x = 1st XY harmonic; y = 2nd XY harmonic; z = Z frequency\n\n            out float vFogAmount;\n            uniform float fogDistance;\n            uniform float fogStartDistance;\n\n            const vec2 VERTICES[6] = vec2[6](\n                vec2(-1.0f, -1.0f),\n                vec2( 1.0f, -1.0f),\n                vec2(-1.0f, 1.0f),\n                vec2( 1.0f, -1.0f),\n                vec2( 1.0f, 1.0f),\n                vec2(-1.0f, 1.0f)\n            );\n\n            void main() {\n                vec4 vertex = vec4(VERTICES[gl_VertexID % 6], 0.0, 1.0);\n                vertex.y += float(gl_VertexID / 6) * 2.0;\n\n                float t = vertex.y / dimensions.x; // normalized length\n                float w = smoothstep(0.0, 0.2, t) * (1.0 - smoothstep(0.8, 1.0, t)); // width coefficient for thin start+end\n\n                vertex.x *= w;\n                vertex.x *= dimensions.y;\n\n                vertex.xyz += offset;\n\n                // combine 2 sine waves for horizontal waves\n                vec2 noise = sin(vertex.yz * frequencies.x) * amplitudes.x;\n                noise += sin(vertex.yz * frequencies.y) * amplitudes.y;\n\n                // vertical wave\n                float noise2 = sin(vertex.y * frequencies.z) * amplitudes.z;\n\n                vertex.xy += noise;\n                vertex.z += noise2;\n\n                gl_Position = view_proj_matrix * vertex;\n\n                vFogAmount = 1.0 - clamp((length(gl_Position) - fogStartDistance) / fogDistance, 0.0, 1.0);\n            }",this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n\n            in float vFogAmount;\n            uniform vec4 color;\n            out vec4 fragColor;\n\n            void main() {\n                fragColor = color * vFogAmount;\n            }"}fillUniformsAttributes(){this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.color=this.getUniform("color"),this.offset=this.getUniform("offset"),this.dimensions=this.getUniform("dimensions"),this.amplitudes=this.getUniform("amplitudes"),this.frequencies=this.getUniform("frequencies"),this.fogDistance=this.getUniform("fogDistance"),this.fogStartDistance=this.getUniform("fogStartDistance")}draw(t,e,i,n,r,o,s,a,h,l,d){const m=t.gl;t.calculateMVPMatrix(e,i,n,r,o,s,a,h,l),m.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),m.drawArrays(m.TRIANGLES,0,6*d),t.checkGlError("WindStripeShader drawArrays")}}class q{constructor(t,e){this.y=e?this.prepareSplineCoords(t):t;const i=t.length;this.y2=new Array(i),this.y2.fill(0);const n=new Array(i);n.fill(0);for(let e=1;e<i-1;e++)this.y2[e]=-1/(4+this.y2[e-1]),n[e]=(6*(t[e+1]-2*t[e]+t[e-1])-n[e-1])/(4+this.y2[e-1]);for(let t=i-2;t>=0;t--)this.y2[t]=this.y2[t]*this.y2[t+1]+n[t]}clamp(t,e,i){return Math.max(Math.min(t,i),e)}getCurrentPoint(t){const e=this.clamp(t,0,1);if(0===e)return this.y[2];if(1===e)return this.y[this.y.length-2];const i=Math.floor(e*(this.y.length-4)+2),n=e*(this.y.length-4)+2-i;return this.fn(i,n)}fn(t,e){return e*this.y[t+1]-(e-1)*e*((e-2)*this.y2[t]-(e+1)*this.y2[t+1])/6+this.y[t]-e*this.y[t]}xySplineFn(t,e){let i=e,n=0,r=e/3+.3333333333;do{const e=1-r;r+=(1*t[0]*Math.pow(r,3)+3*t[1]*Math.pow(r,2)*Math.pow(e,1)+3*t[2]*Math.pow(r,1)*Math.pow(e,2)+1*t[3]*Math.pow(e,3)-r)/2,i=3*(r-.3333333333)}while(Math.pow(i-e,2)>1e-4);return n=1*this.y[0]*Math.pow(1-r,3)+3*this.y[1]*Math.pow(1-r,2)*Math.pow(r,1)+3*this.y[2]*Math.pow(1-r,1)*Math.pow(r,2)+1*this.y[3]*Math.pow(r,3),n}prepareSplineCoords(t){return t[0]=t[t.length-4],t[1]=t[t.length-3],t[t.length-2]=t[2],t[t.length-1]=t[3],t}}class J{constructor(t,e,i,n){this.currentPoint={x:0,y:0,z:0},this.currentRotation={x:0,y:0,z:0},this.splineX=new q(e,t),this.splineY=new q(i,t),this.splineZ=new q(n,t)}getCurrentPoint(t){return this.currentPoint.x=this.splineX.getCurrentPoint(t),this.currentPoint.y=this.splineY.getCurrentPoint(t),this.currentPoint.z=this.splineZ.getCurrentPoint(t),this.currentPoint}getRotation(t){this.getCurrentPoint(t);let e=t+1e-4;e>1&&(e-=1);const i=this.splineX.getCurrentPoint(e),n=this.splineY.getCurrentPoint(e),r=this.splineZ.getCurrentPoint(e);return this.currentRotation.x=180*Math.atan2(this.currentPoint.z-r,this.currentPoint.y-n)/Math.PI,this.currentRotation.y=180*Math.atan2(this.currentPoint.z-r,this.currentPoint.x-i)/Math.PI,this.currentRotation.z=180*Math.atan2(this.currentPoint.x-i,this.currentPoint.y-n)/Math.PI,this.currentRotation}}const Q=new J(!0,[-0,-0,102,100,108,106,-0,-0],[-0,-0,44,60,60,44,-0,-0],[0,0,20,20,20,20,0,0]),tt=new J(!0,[-0,-0,100,100,100,100,106,106,108,106,-0,-0],[-0,-0,20,-0,-20,-40,-40,-20,-0,20,-0,-0],[0,0,20,20,20,20,20,20,20,20,0,0]),et=new J(!0,[0,0,121.24000000000001,138.56,155.88,173.2,190.51999999999998,207.83999999999997,225.15999999999997,242.48000000000002,259.8,242.48000000000002,225.15999999999997,207.83999999999997,190.51999999999998,173.2,155.88,138.56,121.24000000000001,0,0],[0,0,-70,-80,-90,-100,-90,-80,-70,-60,-50,-60,-70,-80,-90,-100,-90,-80,-70,0,0],[0,0,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,0,0]),it=new J(!0,[0,0,190.51999999999998,207.83999999999997,225.15999999999997,242.48000000000002,259.8,259.8,242.48000000000002,225.15999999999997,207.83999999999997,190.51999999999998,0,0],[0,0,70,80,70,60,50,50,60,70,80,70,0,0],[0,0,20,20,20,20,20,20,20,20,20,20,0,0]),nt=new J(!0,[0,0,17.32,86.6,0,0],[0,0,-110,-70,0,0],[0,0,40,40,0,0]),rt=new J(!0,[0,0,-51.959999999999994,-34.64,17.32,34.64,34.64,17.2,-17.32,-51.959999999999994,0,0],[0,0,-30,-60,-70,-40,0,30,30,10,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]),ot=[{start:{position:new Float32Array([-180.70840454101562,344.12786865234375,464.48724365234375]),rotation:new Float32Array([1.0439989566802979,2.0820043087005615,0])},end:{position:new Float32Array([-112.06977844238281,-171.38133239746094,366.0000305175781]),rotation:new Float32Array([1.031998872756958,.6360000967979431,0])},speedMultiplier:1},{start:{position:new Float32Array([-65.85258483886719,-533.7212524414062,97.40440368652344]),rotation:new Float32Array([.12599997222423553,.1620001345872879,0])},end:{position:new Float32Array([33.180965423583984,144.239501953125,41.7051887512207]),rotation:new Float32Array([.12599997222423553,.1620001345872879,0])},speedMultiplier:1},{start:{position:new Float32Array([372.5055236816406,88.55387115478516,69.73857879638672]),rotation:new Float32Array([.06599999964237213,4.801174163818359,0])},end:{position:new Float32Array([-65.18380737304688,126.53640747070312,42.17599105834961]),rotation:new Float32Array([.03599999472498894,4.77117395401001,0])},speedMultiplier:1},{start:{position:new Float32Array([131.52081298828125,301.15557861328125,130.46836853027344]),rotation:new Float32Array([.7680003643035889,3.9600257873535156,0])},end:{position:new Float32Array([206.39492797851562,-6.715636253356934,139.7966766357422]),rotation:new Float32Array([1.0679999589920044,4.710031032562256,0])},speedMultiplier:1},{start:{position:new Float32Array([202.11294555664062,-170.178466796875,58.734954833984375]),rotation:new Float32Array([.24599967896938324,6.007182598114014,0])},end:{position:new Float32Array([128.2172393798828,107.47187805175781,134.7461700439453]),rotation:new Float32Array([.7979993224143982,5.935182094573975,0])},speedMultiplier:1},{start:{position:new Float32Array([279.81304931640625,664.1943359375,275.15228271484375]),rotation:new Float32Array([.3720014989376068,3.6517090797424316,0])},end:{position:new Float32Array([-17.399612426757812,47.14397048950195,86.219970703125]),rotation:new Float32Array([.3240014612674713,4.449714660644531,0])},speedMultiplier:1},{start:{position:new Float32Array([-195.9441680908203,700.3867797851562,418.3968811035156]),rotation:new Float32Array([.6000023484230042,2.7540125846862793,0])},end:{position:new Float32Array([1.8704317808151245,160.99075317382812,147.00608825683594]),rotation:new Float32Array([.26400214433670044,2.994014263153076,0])},speedMultiplier:1},{start:{position:new Float32Array([-248.67987060546875,-320.5169982910156,593.5792236328125]),rotation:new Float32Array([.7679989337921143,.48600319027900696,0])},end:{position:new Float32Array([-151.6046142578125,290.5845947265625,197.34095764160156]),rotation:new Float32Array([.7859989404678345,2.172008752822876,0])},speedMultiplier:1},{start:{position:new Float32Array([-90.51039123535156,348.780517578125,67.15997314453125]),rotation:new Float32Array([.11399991810321808,2.863162040710449,0])},end:{position:new Float32Array([-27.74077606201172,119.6170883178711,377.1683654785156]),rotation:new Float32Array([1.169999599456787,2.9051623344421387,0])},speedMultiplier:1},{start:{position:new Float32Array([82.28939056396484,445.0611572265625,93.37278747558594]),rotation:new Float32Array([.17400018870830536,3.3000097274780273,0])},end:{position:new Float32Array([16.53315544128418,33.45115661621094,35.45589065551758]),rotation:new Float32Array([.17400018870830536,3.3000097274780273,0])},speedMultiplier:1},{start:{position:new Float32Array([78.29499816894531,-17.22335433959961,70.7376480102539]),rotation:new Float32Array([.6720003485679626,3.480013608932495,0])},end:{position:new Float32Array([78.29499816894531,-17.22335433959961,70.7376480102539]),rotation:new Float32Array([.3780005872249603,5.832029819488525,0])},speedMultiplier:1},{start:{position:new Float32Array([-146.90318298339844,142.15151977539062,66.49613952636719]),rotation:new Float32Array([.47400030493736267,.9359981417655945,0])},end:{position:new Float32Array([-17.769685745239258,261.3605651855469,81.00308990478516]),rotation:new Float32Array([1.007999062538147,3.918010950088501,0])},speedMultiplier:1},{start:{position:new Float32Array([156.03762817382812,195.03221130371094,66.18341827392578]),rotation:new Float32Array([.3479999899864197,4.95717716217041,0])},end:{position:new Float32Array([14.030660629272461,225.5084686279297,24.763769149780273]),rotation:new Float32Array([.22799980640411377,4.735175609588623,0])},speedMultiplier:1},{start:{position:new Float32Array([33.84556579589844,167.5606231689453,66.10122680664062]),rotation:new Float32Array([1.0499999523162842,2.8188557624816895,0])},end:{position:new Float32Array([45.27586364746094,158.3726348876953,31.550251007080078]),rotation:new Float32Array([.6780003309249878,3.244858741760254,0])},speedMultiplier:1},{start:{position:new Float32Array([36.692195892333984,120.5238265991211,10.132575035095215]),rotation:new Float32Array([.0299999937415123,4.801177501678467,0])},end:{position:new Float32Array([-41.80580520629883,171.68023681640625,30.876060485839844]),rotation:new Float32Array([.5100004076957703,3.319167137145996,0])},speedMultiplier:1},{start:{position:new Float32Array([7.791806697845459,136.1355743408203,41.7769889831543]),rotation:new Float32Array([.6599994897842407,4.5300211906433105,0])},end:{position:new Float32Array([-62.04362106323242,219.46224975585938,69.3672866821289]),rotation:new Float32Array([.7379992604255676,3.2460103034973145,0])},speedMultiplier:1},{start:{position:new Float32Array([-212.7830047607422,26.864469528198242,47.52628707885742]),rotation:new Float32Array([.4740002751350403,1.2131590843200684,0])},end:{position:new Float32Array([-106.01717376708984,104.0726318359375,52.95517349243164]),rotation:new Float32Array([.6719997525215149,-.35565641403198267,0])},speedMultiplier:1},{start:{position:new Float32Array([-202.10008239746094,240.60462951660156,100.6684799194336]),rotation:new Float32Array([1.1399996280670166,2.718008041381836,0])},end:{position:new Float32Array([-47.3318977355957,94.16532135009766,91.72081756591797]),rotation:new Float32Array([.6600000262260437,1.4159926176071167,0])},speedMultiplier:1},{start:{position:new Float32Array([-298.9365539550781,133.06166076660156,16.645557403564453]),rotation:new Float32Array([.0660000592470169,1.5480033159255981,0])},end:{position:new Float32Array([-249.6297149658203,-25.413482666015625,51.728633880615234]),rotation:new Float32Array([.3420001268386841,.7860006093978882,0])},speedMultiplier:1},{start:{position:new Float32Array([-541.5399169921875,-31.938264846801758,14.510990142822266]),rotation:new Float32Array([.01799987070262432,1.2720028162002563,0])},end:{position:new Float32Array([-168.18260192871094,114.04676055908203,50.46665954589844]),rotation:new Float32Array([.5580002069473267,1.368003487586975,0])},speedMultiplier:1},{start:{position:new Float32Array([-86.40751647949219,-398.1352233886719,13.765576362609863]),rotation:new Float32Array([-.2579997777938843,.030000174418091774,0])},end:{position:new Float32Array([-124.21296691894531,103.60616302490234,182.36685180664062]),rotation:new Float32Array([.893999457359314,1.386001706123352,0])},speedMultiplier:1},{start:{position:new Float32Array([-112.36286163330078,-105.78300476074219,156.2106170654297]),rotation:new Float32Array([.9179993271827698,1.4820020198822021,0])},end:{position:new Float32Array([10.100805282592773,-152.53306579589844,56.91889953613281]),rotation:new Float32Array([.6060008406639099,.5040009617805481,0])},speedMultiplier:1},{start:{position:new Float32Array([91.12299346923828,-164.51905822753906,40]),rotation:new Float32Array([.4319993853569031,-.6928184318542483,0])},end:{position:new Float32Array([-84.89698028564453,-186.57069396972656,94.95513153076172]),rotation:new Float32Array([.6240002512931824,.8039996027946472,0])},speedMultiplier:1},{start:{position:new Float32Array([46.48644256591797,-247.68185424804688,136.48138427734375]),rotation:new Float32Array([.49200037121772766,5.911182880401611,0])},end:{position:new Float32Array([135.65267944335938,292.2001037597656,66.20657348632812]),rotation:new Float32Array([.1560002565383911,3.877168655395508,0])},speedMultiplier:1},{start:{position:new Float32Array([-185.5640869140625,275.6010437011719,99.46765899658203]),rotation:new Float32Array([.35999998450279236,1.950005054473877,0])},end:{position:new Float32Array([-187.9376983642578,-36.43680191040039,91.44284057617188]),rotation:new Float32Array([.2819998264312744,.8999989628791809,0])},speedMultiplier:1},{start:{position:new Float32Array([77.51092529296875,-15.743629455566406,185.93775939941406]),rotation:new Float32Array([.5579999685287476,5.995182514190674,0])},end:{position:new Float32Array([126.171142578125,377.15887451171875,139.98440551757812]),rotation:new Float32Array([.504000186920166,3.6491665840148926,0])},speedMultiplier:1}],st=[1,1,1,.5,.8,1,1,1,.9,.8,.5,.4,.5,.3,.3,.3,.5,.6,.7,.7,1,.6,.6,1,.9,1];window.camerasString=(()=>{let t="";for(const e of ot)t+=`\n        new CameraPositionPair() {{\n            start = new CameraPosition() {{\n                position = new Point3D(${e.start.position});\n                rotation = new Point3D(${e.start.rotation});\n            }};\n            end = new CameraPosition() {{\n                position = new Point3D(${e.end.position});\n                rotation = new Point3D(${e.end.rotation});\n            }};\n            speedMultiplier = ${e.speedMultiplier}f;\n        }},\n        `;return t})();class at{constructor(){this.map=new Map,this.lastTime=0}add(t,e,i=!0){this.map.set(t,[0,e,i])}get(t){const e=this.map.get(t);if(void 0!==e)return e[0];throw new Error("Timer not found")}set(t,e){const i=this.map.get(t);void 0!==i&&(i[0]=e)}iterate(){const t=(new Date).getTime();for(const e of this.map.values())e[0]+=(t-this.lastTime)/e[1],e[2]?e[0]%=1:e[0]>1&&(e[0]=1);this.lastTime=t}}var ht;!function(t){t[t.Flags=0]="Flags",t[t.HeadAnimation1=1]="HeadAnimation1",t[t.ArmsAnimation1=2]="ArmsAnimation1",t[t.ArmsAnimation2=3]="ArmsAnimation2",t[t.Step1=4]="Step1",t[t.Spline1=5]="Spline1",t[t.Spline2=6]="Spline2",t[t.Spline3=7]="Spline3",t[t.Wings=8]="Wings",t[t.BirdsFly=9]="BirdsFly",t[t.WindMove1=10]="WindMove1",t[t.WindMove2=11]="WindMove2",t[t.WindMove3=12]="WindMove3",t[t.Fade=13]="Fade",t[t.Camera=14]="Camera"}(ht||(ht={}));var lt,dt;!function(t){t[t.NONE=0]="NONE",t[t.MANUAL_ROTATING=1]="MANUAL_ROTATING",t[t.AUTO_ROTATING=2]="AUTO_ROTATING"}(lt||(lt={}));class mt{constructor(t,e){this.renderer=t,this.options=e,this.lastX=-1,this.lastY=-1,this.state=lt.NONE,this.viewMatrix=g(),this.position=T(1,0,0),this.center=T(0,0,0),this.enabled=!1,this.autoRotate=!0,this.yaw=e.yaw,this.pitch=e.pitch,this.radius=e.radius,this.speed=e.speed,this.zoomSpeed=e.zoomSpeed,this.autoRotateSpeed=e.autoRotateSpeed,this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.minRadius=e.minRadius,this.maxRadius=e.maxRadius,this.origin=new Float32Array(e.origin),this.initialize()}enable(){this.enabled=!0}disable(){this.enabled=!1,this.renderer.setCustomCamera(void 0)}initialize(){var t,e,i,n;null===(t=this.renderer.getCanvas())||void 0===t||t.addEventListener("mousedown",(t=>{if(0===t.button){this.state=lt.MANUAL_ROTATING;const{clientX:e,clientY:i}=t;this.lastX=e,this.lastY=i,this.autoRotate=!1}})),null===(e=this.renderer.getCanvas())||void 0===e||e.addEventListener("mouseup",(t=>{this.state=lt.NONE,clearTimeout(this.autoRotateTimeout),this.autoRotateTimeout=window.setTimeout((()=>{this.autoRotate=!0}),3e3)})),null===(i=this.renderer.getCanvas())||void 0===i||i.addEventListener("mousemove",(t=>{if(this.state===lt.MANUAL_ROTATING){const{clientX:e,clientY:i}=t,n=this.lastX-t.clientX,r=this.lastY-t.clientY;this.updateRendererCamera(n,r),this.lastX=e,this.lastY=i}})),null===(n=this.renderer.getCanvas())||void 0===n||n.addEventListener("wheel",(t=>{this.radius+=t.deltaY*this.zoomSpeed,this.updateRendererCamera()})),setInterval((()=>{this.state===lt.NONE&&this.autoRotate&&(this.yaw+=this.autoRotateSpeed,this.updateRendererCamera())}),16)}updateRendererCamera(t=0,e=0){this.yaw+=t*this.speed,this.pitch+=e*this.speed,this.pitch>this.maxPitch&&(this.pitch=this.maxPitch),this.pitch<this.minPitch&&(this.pitch=this.minPitch),this.radius>this.maxRadius&&(this.radius=this.maxRadius),this.radius<this.minRadius&&(this.radius=this.minRadius),this.position[0]=1,this.position[1]=0,this.position[2]=0,function(t,e,i,n){var r=[],o=[];r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2]}(this.position,this.position,this.center,-this.pitch),function(t,e,i,n){var r=[],o=[];r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2]}(this.position,this.position,this.center,this.yaw);const i=this.radius*this.position[0]+this.origin[0],n=this.radius*this.position[1]+this.origin[1],r=this.radius*this.position[2]+this.origin[2];C(this.viewMatrix,[i,n,r],this.origin,[0,0,1]),this.enabled&&this.renderer.setCustomCamera(this.viewMatrix)}}class ct{constructor(t){var e,i;this.options=t,this._dirty=!0,this._angles=M(),this._position=M(),this.speed=100,this.rotationSpeed=.025,this._cameraMat=g(),this._viewMat=g(),this.projectionMat=g(),this.pressedKeys=new Array,this.vec3Temp1=M(),this.vec3Temp2=M(),this.canvas=t.canvas,this.speed=null!==(e=t.movementSpeed)&&void 0!==e?e:100,this.rotationSpeed=null!==(i=t.rotationSpeed)&&void 0!==i?i:.025;let n,r,o=!1;window.addEventListener("keydown",(t=>this.pressedKeys[t.keyCode]=!0)),window.addEventListener("keyup",(t=>this.pressedKeys[t.keyCode]=!1)),this.canvas.addEventListener("contextmenu",(t=>t.preventDefault())),this.canvas.addEventListener("mousedown",(t=>{3===t.which&&(o=!0),n=t.pageX,r=t.pageY})),this.canvas.addEventListener("mousemove",(t=>{if(o){let e=t.pageX-n,i=t.pageY-r;n=t.pageX,r=t.pageY,this.angles[1]+=e*this.rotationSpeed,this.angles[1]<0&&(this.angles[1]+=2*Math.PI),this.angles[1]>=2*Math.PI&&(this.angles[1]-=2*Math.PI),this.angles[0]+=i*this.rotationSpeed,this.angles[0]<.5*-Math.PI&&(this.angles[0]=.5*-Math.PI),this.angles[0]>.5*Math.PI&&(this.angles[0]=.5*Math.PI),this._dirty=!0}})),this.canvas.addEventListener("mouseup",(t=>o=!1))}get angles(){return this._angles}set angles(t){this._angles=t,this._dirty=!0}get position(){return this._position}set position(t){this._position=t,this._dirty=!0}get dirty(){return this._dirty}set dirty(t){this._dirty=t}get viewMat(){if(this._dirty){var t=this._viewMat;p(t),E(t,t,this.angles[0]-Math.PI/2),w(t,t,this.angles[1]),b(t,t,this.angles[2]),x(t,t,[-this.position[0],-this.position[1],-this.position[2]]),this._dirty=!1}return this._viewMat}update(t){this.vec3Temp1[0]=0,this.vec3Temp1[1]=0,this.vec3Temp1[2]=0;let e=this.speed/1e3*t;if(this.pressedKeys[16]&&(e*=5),this.pressedKeys["W".charCodeAt(0)]&&(this.vec3Temp1[1]+=e),this.pressedKeys["S".charCodeAt(0)]&&(this.vec3Temp1[1]-=e),this.pressedKeys["A".charCodeAt(0)]&&(this.vec3Temp1[0]-=e),this.pressedKeys["D".charCodeAt(0)]&&(this.vec3Temp1[0]+=e),this.pressedKeys[32]&&(this.vec3Temp1[2]+=e),this.pressedKeys["C".charCodeAt(0)]&&(this.vec3Temp1[2]-=e),0!==this.vec3Temp1[0]||0!==this.vec3Temp1[1]||0!==this.vec3Temp1[2]){let t=this._cameraMat;if(p(t),E(t,t,this.angles[0]),w(t,t,this.angles[1]),v(t,t),function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];s=s||1,t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/s,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s}(this.vec3Temp1,this.vec3Temp1,t),function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(this.position,this.position,this.vec3Temp1),this.options.boundingBox){const{boundingBox:t}=this.options;this.position[0]<t.minX&&(this.position[0]=t.minX),this.position[0]>t.maxX&&(this.position[0]=t.maxX),this.position[1]<t.minY&&(this.position[1]=t.minY),this.position[1]>t.maxY&&(this.position[1]=t.maxY),this.position[2]<t.minZ&&(this.position[2]=t.minZ),this.position[2]>t.maxZ&&(this.position[2]=t.maxZ)}this._dirty=!0}}}!function(t){t[t.Free=0]="Free",t[t.Predefined=1]="Predefined"}(dt||(dt={}));class ft{constructor(t,e){this.renderer=t,this.options=e,this.matCamera=g(),this.matInvCamera=new Float32Array(16),this.vec3Eye=new Float32Array(3),this.vec3Rotation=new Float32Array(3),this.enabled=!1,this.mode=dt.Predefined,this.setupControls()}enable(){this.enabled=!0}disable(){this.enabled=!1,this.renderer.setCustomCamera(void 0)}setupControls(){var t;this.matCamera=function(t){var e=new u(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}(this.renderer.getViewMatrix()),this.mode=dt.Free,v(this.matInvCamera,this.matCamera),function(t,e){t[0]=e[12],t[1]=e[13],t[2]=e[14]}(this.vec3Eye,this.matInvCamera),function(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o}(this.vec3Rotation,this.vec3Eye),function(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}(this.vec3Rotation,this.vec3Rotation,-1),this.fpsCamera=null!==(t=this.fpsCamera)&&void 0!==t?t:new ct(this.options),this.fpsCamera.position=this.vec3Eye;const e=t=>{this.mode===dt.Free&&(this.fpsCamera.update(16),this.matCamera=this.fpsCamera.viewMat,this.enabled&&this.renderer.setCustomCamera(this.matCamera,this.fpsCamera.position,this.fpsCamera.angles),requestAnimationFrame(e))};e()}updatePosition(t){this.fpsCamera&&(this.fpsCamera.position[0]=t[0],this.fpsCamera.position[1]=t[1],this.fpsCamera.position[2]=t[2],this.fpsCamera.dirty=!0,this.fpsCamera.update(0))}updateRotation(t){this.fpsCamera&&(this.fpsCamera.angles[0]=t[0],this.fpsCamera.angles[1]=t[1],this.fpsCamera.angles[2]=t[2],this.fpsCamera.dirty=!0,this.fpsCamera.update(0))}}class ut extends class{constructor(){this.mMMatrix=s(),this.mVMatrix=s(),this.mMVPMatrix=s(),this.mProjMatrix=s(),this.matOrtho=s(),this.m_boundTick=this.tick.bind(this),this.isWebGL2=!1,this.viewportWidth=0,this.viewportHeight=0}get gl(){if(void 0===this.m_gl)throw new Error("No WebGL context");return this.m_gl}logGLError(){var t=this.gl.getError();t!==this.gl.NO_ERROR&&console.warn(`WebGL error # + ${t}`)}setTexture2D(t,e,i){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(i,t)}setTextureCubemap(t,e,i){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e),this.gl.uniform1i(i,t)}setFOV(t,e,i,n,r){const o=Math.tan(e/360*Math.PI)*n,s=o*i;!function(t,e,i,n,r,o,s){var a=1/(i-e),h=1/(r-n),l=1/(o-s);t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*h,t[10]=(s+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*l,t[15]=0}(t,-s,s,-o,o,n,r)}calculateMVPMatrix(t,e,i,n,r,o,s,h,l){!function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this.mMMatrix),function(t,e,i,n){var r,o,s,a,h,l,d,m,c,f,u,g,_,p,v,x,E,b,w,A,y,C,M,T,R=n[0],S=n[1],F=n[2],P=Math.hypot(R,S,F);P<1e-6||(R*=P=1/P,S*=P,F*=P,r=Math.sin(i),s=1-(o=Math.cos(i)),a=e[0],h=e[1],l=e[2],d=e[3],m=e[4],c=e[5],f=e[6],u=e[7],g=e[8],_=e[9],p=e[10],v=e[11],x=R*R*s+o,E=S*R*s+F*r,b=F*R*s-S*r,w=R*S*s-F*r,A=S*S*s+o,y=F*S*s+R*r,C=R*F*s+S*r,M=S*F*s-R*r,T=F*F*s+o,t[0]=a*x+m*E+g*b,t[1]=h*x+c*E+_*b,t[2]=l*x+f*E+p*b,t[3]=d*x+u*E+v*b,t[4]=a*w+m*A+g*y,t[5]=h*w+c*A+_*y,t[6]=l*w+f*A+p*y,t[7]=d*w+u*A+v*y,t[8]=a*C+m*M+g*T,t[9]=h*C+c*M+_*T,t[10]=l*C+f*M+p*T,t[11]=d*C+u*M+v*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this.mMMatrix,this.mMMatrix,0,[1,0,0]),function(t,e,i){var n,r,o,s,a,h,l,d,m,c,f,u,g=i[0],_=i[1],p=i[2];e===t?(t[12]=e[0]*g+e[4]*_+e[8]*p+e[12],t[13]=e[1]*g+e[5]*_+e[9]*p+e[13],t[14]=e[2]*g+e[6]*_+e[10]*p+e[14],t[15]=e[3]*g+e[7]*_+e[11]*p+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],d=e[7],m=e[8],c=e[9],f=e[10],u=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=l,t[7]=d,t[8]=m,t[9]=c,t[10]=f,t[11]=u,t[12]=n*g+a*_+m*p+e[12],t[13]=r*g+h*_+c*p+e[13],t[14]=o*g+l*_+f*p+e[14],t[15]=s*g+d*_+u*p+e[15])}(this.mMMatrix,this.mMMatrix,[t,e,i]),function(t,e,i){var n=i[0],r=i[1],o=i[2];t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.mMMatrix,this.mMMatrix,[s,h,l]),function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],h=e[7],l=e[8],d=e[9],m=e[10],c=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+l*n,t[5]=s*r+d*n,t[6]=a*r+m*n,t[7]=h*r+c*n,t[8]=l*r-o*n,t[9]=d*r-s*n,t[10]=m*r-a*n,t[11]=c*r-h*n}(this.mMMatrix,this.mMMatrix,n),function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],l=e[8],d=e[9],m=e[10],c=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-l*n,t[1]=s*r-d*n,t[2]=a*r-m*n,t[3]=h*r-c*n,t[8]=o*n+l*r,t[9]=s*n+d*r,t[10]=a*n+m*r,t[11]=h*n+c*r}(this.mMMatrix,this.mMMatrix,r),function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],l=e[4],d=e[5],m=e[6],c=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+l*n,t[1]=s*r+d*n,t[2]=a*r+m*n,t[3]=h*r+c*n,t[4]=l*r-o*n,t[5]=d*r-s*n,t[6]=m*r-a*n,t[7]=c*r-h*n}(this.mMMatrix,this.mMMatrix,o),a(this.mMVPMatrix,this.mVMatrix,this.mMMatrix),a(this.mMVPMatrix,this.mProjMatrix,this.mMVPMatrix)}drawScene(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}tick(){requestAnimationFrame(this.m_boundTick),this.resizeCanvas(),this.drawScene(),this.animate()}initGL(t){const e=t.getContext("webgl",{alpha:!1});if(null===e)throw new Error("Cannot initialize WebGL context");return e}initGL2(t){let e=t.getContext("webgl2",{alpha:!1});return null===e?(console.warn("Could not initialise WebGL 2, falling back to WebGL 1"),this.initGL(t)):e}generateMipmaps(...t){for(const e of t)this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.generateMipmap(this.gl.TEXTURE_2D)}init(t,e=!1){if(this.onBeforeInit(),this.canvas=document.getElementById(t),null===this.canvas)throw new Error("Cannot find canvas element");this.viewportWidth=this.canvas.width,this.viewportHeight=this.canvas.height,this.m_gl=e?this.initGL2(this.canvas):this.initGL(this.canvas),this.m_gl?(this.resizeCanvas(),this.onAfterInit(),this.initShaders(),this.loadData(),this.m_boundTick()):this.onInitError()}resizeCanvas(){if(void 0===this.canvas)return;const t=window.devicePixelRatio||1,e=Math.floor(this.canvas.clientWidth*t),i=Math.floor(this.canvas.clientHeight*t);this.canvas.width==e&&this.canvas.height==i||(this.canvas.width=e,this.canvas.height=i)}checkGlError(t){let e;for(;(e=this.gl.getError())!==this.gl.NO_ERROR;)console.error(`${t}: glError ${e}`)}unbindBuffers(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}getMVPMatrix(){return this.mMVPMatrix}getOrthoMatrix(){return this.matOrtho}getModelMatrix(){return this.mMMatrix}getViewMatrix(){return this.mVMatrix}}{constructor(){super(),this.lastTime=0,this.loaded=!1,this.fmCastleInner=new n,this.fmCastleOuter=new n,this.fmGround=new n,this.fmFlag1=new n,this.fmFlag2=new n,this.fmFlag3=new n,this.fmKnight=new n,this.fmEagle=new n,this.Z_NEAR=10,this.Z_FAR=2e3,this.FLAGS_PERIOD=800,this.WALK_ANIM_SPEED=2,this.HEAD1_PERIOD=5e3/this.WALK_ANIM_SPEED,this.ARM1_PERIOD=2100/this.WALK_ANIM_SPEED,this.ARM2_PERIOD=2e3,this.STEP1_PERIOD=2100/this.WALK_ANIM_SPEED,this.SPLINE1_PERIOD=37e3,this.SPLINE2_PERIOD=11e3,this.SPLINE3_PERIOD=18e3,this.WINGS_PERIOD=3e3,this.BIRD_FLIGHT_PERIOD=22e3,this.WIND_MOVE_PERIOD1=7e3,this.WIND_MOVE_PERIOD2=7500,this.WIND_MOVE_PERIOD3=8e3,this.FADE_PERIOD=2500,this.CAMERA_PERIOD=34e3,this.timers=new at,this.randomWindCoeff1=Math.random(),this.randomWindCoeff2=Math.random(),this.randomWindCoeff3=Math.random(),this.cameraMode=A.Orbiting,this.cameraPosition=M(),this.cameraRotation=M(),this.BIRD_FLIGHT_RADIUS=150,this.config={ambient:.45,diffuse:1,diffuseCoeff:1.5,diffuseExponent:1,shadowBrightness:.5,flagsAmplitude:.15,flagsWaves:5,lightDistanceLow:3300,lightHeightLow:1700,lightDistance:2200,lightHeight:3800,lightNear:3e3,lightFar:5e3,lightFov:18,fogColor:[.41,.75,.92,1],fogStartDistance:500,fogDistance:400,timeOfDay:0,shadowResolution:2},this.SHADOWMAP_SIZE=2048,this.SHADOWMAP_TEXEL_OFFSET_SCALE=.666,this.PCF_BIAS_CORRECTION=1.5/this.SHADOWMAP_SIZE,this.mViewMatrixLight=g(),this.mProjMatrixLight=g(),this.pointLight=M(),this.cameraPositionInterpolator=new G,this.CAMERA_SPEED=1,this.CAMERA_MIN_DURATION=11e3,this.currentRandomCamera=0,this.currentLightDirection=1,this.tempAmbient=[0,0,0,1],this.tempDiffuse=[0,0,0,1],this.tempFog=[0,0,0,1],this.framesCount=0,this.SCALE=20,this.smallFlags2=[[-6,2.9,0],[3,4.5,5.196],[-3,2.5,5.196],[-3,2.9,-8.66]],this.smallFlags3=[[-2,2.9,-13.856],[2,2.9,-13.856],[-.9,3.8,-9.326]],this.cameraPositionInterpolator.speed=this.CAMERA_SPEED,this.cameraPositionInterpolator.minDuration=this.CAMERA_MIN_DURATION,this.randomizeCamera(),this.setupTimers(),document.addEventListener("keypress",(t=>{"1"===t.key?(ot[0].start={position:new Float32Array([this.cameraPosition[0],this.cameraPosition[1],this.cameraPosition[2]]),rotation:new Float32Array([this.cameraRotation[0],this.cameraRotation[1],this.cameraRotation[2]])},this.logCamera()):"2"===t.key&&(ot[0].end={position:new Float32Array([this.cameraPosition[0],this.cameraPosition[1],this.cameraPosition[2]]),rotation:new Float32Array([this.cameraRotation[0],this.cameraRotation[1],this.cameraRotation[2]])},this.logCamera())}))}setupTimers(){this.timers.add(ht.Flags,this.FLAGS_PERIOD),this.timers.add(ht.HeadAnimation1,this.HEAD1_PERIOD),this.timers.add(ht.ArmsAnimation1,this.ARM1_PERIOD),this.timers.add(ht.ArmsAnimation2,this.ARM2_PERIOD),this.timers.add(ht.Step1,this.STEP1_PERIOD),this.timers.add(ht.Spline1,this.SPLINE1_PERIOD),this.timers.add(ht.Spline2,this.SPLINE2_PERIOD),this.timers.add(ht.Spline3,this.SPLINE3_PERIOD),this.timers.add(ht.Wings,this.WINGS_PERIOD),this.timers.add(ht.BirdsFly,this.BIRD_FLIGHT_PERIOD),this.timers.add(ht.WindMove1,this.WIND_MOVE_PERIOD1),this.timers.add(ht.WindMove2,this.WIND_MOVE_PERIOD2),this.timers.add(ht.WindMove3,this.WIND_MOVE_PERIOD3),this.timers.add(ht.Fade,this.FADE_PERIOD,!1),this.timers.add(ht.Camera,this.CAMERA_PERIOD)}setCustomCamera(t,e,i){this.customCamera=t,void 0!==e&&(this.cameraPosition=e),void 0!==i&&(this.cameraRotation=i)}resetCustomCamera(){this.customCamera=void 0}onBeforeInit(){}onAfterInit(){this.orbitControls=new mt(this,{yaw:Math.random()*Math.PI*2,pitch:2.5,radius:400,speed:.004,zoomSpeed:.3,autoRotateSpeed:8e-4,minPitch:1.7,maxPitch:3.1,minRadius:200,maxRadius:700,origin:[0,0,50]}),this.freeMovement=new ft(this,{canvas:this.canvas,movementSpeed:35,rotationSpeed:.006,boundingBox:{minX:-500,maxX:500,minY:-500,maxY:500,minZ:10,maxZ:500}}),this.setCameraMode(A.Orbiting)}onInitError(){var t,e;null===(t=document.getElementById("canvasGL"))||void 0===t||t.classList.add("hidden"),null===(e=document.getElementById("alertError"))||void 0===e||e.classList.remove("hidden")}initShaders(){this.shaderDiffuse=new f(this.gl),this.shaderObjects=new L(this.gl),this.shaderObjectsDepth=new N(this.gl),this.shaderFlag=new U(this.gl),this.shaderFlagDepth=new V(this.gl),this.shaderKnight=new k(this.gl),this.shaderKnightDepth=new H(this.gl),this.shaderEagle=new z(this.gl),this.shaderEagleDepth=new j(this.gl),this.shaderWind=new Z(this.gl)}async loadData(){var t;await Promise.all([this.fmCastleInner.load("data/models/castle-inner",this.gl),this.fmCastleOuter.load("data/models/castle-outer",this.gl),this.fmGround.load("data/models/ground",this.gl),this.fmFlag1.load("data/models/flag1",this.gl),this.fmFlag2.load("data/models/flag2",this.gl),this.fmFlag3.load("data/models/flag3",this.gl),this.fmKnight.load("data/models/knightRed",this.gl),this.fmEagle.load("data/models/eagle",this.gl)]);const e=new Uint16Array(144);for(let t=0;t<144;t++)e[t]=t;this.fmKnight.bufferIndices=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.fmKnight.bufferIndices),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.fmKnight.numIndices=e.byteLength/3/2;const n=new Uint16Array(210);for(let t=0;t<210;t++)n[t]=t;this.fmEagle.bufferIndices=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.fmEagle.bufferIndices),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,n,this.gl.STATIC_DRAW),this.fmEagle.numIndices=n.byteLength/3/2,[this.textureKnight,this.textureEagle]=await Promise.all([i.load("data/textures/knightRed.png",this.gl,this.gl.LINEAR,this.gl.LINEAR,!1),i.load("data/textures/eagle.png",this.gl,this.gl.LINEAR,this.gl.LINEAR,!1)]),this.generateMipmaps(this.textureKnight,this.textureEagle),this.loaded=!0,this.timers.set(ht.Fade,0),console.log("Loaded all assets"),this.initOffscreen(),this.initVignette(),null===(t=this.readyCallback)||void 0===t||t.call(this)}resizeCanvas(){void 0!==this.canvas&&super.resizeCanvas()}animate(){this.timers.iterate();const t=(new Date).getTime();0!=this.lastTime&&(this.cameraPositionInterpolator.iterate(t),1===this.cameraPositionInterpolator.timer&&this.cameraMode===A.Random&&this.randomizeCamera()),this.lastTime=t}setCameraFOV(t){var e;e=this.gl.canvas.height>0?this.gl.canvas.width/this.gl.canvas.height:1;let i=0;i=this.gl.canvas.width>=this.gl.canvas.height?35*t:60*t,this.setFOV(this.mProjMatrix,i,e,this.Z_NEAR,this.Z_FAR)}positionCamera(t){void 0===this.customCamera?this.cameraMode===A.Random&&(_(this.mVMatrix,this.cameraPositionInterpolator.matrix),this.cameraPosition[0]=this.cameraPositionInterpolator.cameraPosition[0],this.cameraPosition[1]=this.cameraPositionInterpolator.cameraPosition[1],this.cameraPosition[2]=this.cameraPositionInterpolator.cameraPosition[2]):_(this.mVMatrix,this.customCamera)}positionCameraLight(t){const e=0===this.config.timeOfDay||1===this.config.timeOfDay?this.config.lightDistance:this.config.lightDistanceLow,i=0===this.config.timeOfDay||1===this.config.timeOfDay?this.config.lightHeight:this.config.lightHeightLow,n=Math.sin(t*Math.PI*2)*e,r=Math.cos(t*Math.PI*2)*e,o=i;this.pointLight[0]=n,this.pointLight[1]=r,this.pointLight[2]=o,C(this.mVMatrix,[n,r,o],[0,0,0],[0,0,1]),_(this.mViewMatrixLight,this.mVMatrix)}drawScene(){if(!this.loaded)return;const t=this.getFogColor();this.gl.clearColor(t[0],t[1],t[2],t[3]),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.disable(this.gl.BLEND);const e=this.cameraPositionInterpolator.timer;if(this.framesCount%2==0||e<.02||e>.98){this.gl.colorMask(!1,!1,!1,!1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fboOffscreen.framebufferHandle),this.gl.viewport(0,0,this.fboOffscreen.width,this.fboOffscreen.height),this.gl.depthMask(!0),this.gl.enable(this.gl.DEPTH_TEST),this.gl.clear(this.gl.DEPTH_BUFFER_BIT);const t=this.getLightFov();this.setFOV(this.mProjMatrix,t,1,this.config.lightNear,this.config.lightFar),this.setFOV(this.mProjMatrixLight,t,1,this.config.lightNear,this.config.lightFar),this.positionCameraLight(this.currentLightDirection),this.drawCastleModels(!0)}this.gl.colorMask(!0,!0,!0,!0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.setCameraFOV(1),this.positionCamera(this.timers.get(ht.Camera)),this.drawCastleModels(!1),this.drawWind(),this.framesCount++}getLightFov(){return this.cameraMode===A.Random?this.config.lightFov*st[this.currentRandomCamera]:this.config.lightFov}drawDepthMap(){this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.disable(this.gl.BLEND),this.shaderDiffuse.use(),this.setTexture2D(0,this.textureOffscreenDepth,this.shaderDiffuse.sTexture),this.drawVignette(this.shaderDiffuse)}drawVignette(t){this.unbindBuffers(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.mTriangleVerticesVignette),this.gl.enableVertexAttribArray(t.rm_Vertex),this.gl.vertexAttribPointer(t.rm_Vertex,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(t.rm_TexCoord0),this.gl.vertexAttribPointer(t.rm_TexCoord0,2,this.gl.FLOAT,!1,20,12),this.gl.uniformMatrix4fv(t.view_proj_matrix,!1,this.getOrthoMatrix()),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}drawCastleModels(t){if(void 0===this.shaderObjects||void 0===this.shaderObjectsDepth||void 0===this.shaderFlag||void 0===this.shaderFlagDepth)return;let e;if(t)e=this.shaderObjectsDepth,this.shaderObjectsDepth.use();else{e=this.shaderObjects,this.shaderObjects.use();const t=this.getDiffuseColor(),i=this.getAmbientColor();this.gl.uniform4f(this.shaderObjects.lightDir,this.pointLight[0],this.pointLight[1],this.pointLight[2],0),this.gl.uniform4fv(this.shaderObjects.ambient,i),this.gl.uniform4fv(this.shaderObjects.diffuse,t),this.gl.uniform1f(this.shaderObjects.diffuseCoef,this.config.diffuseCoeff),this.gl.uniform1f(this.shaderObjects.diffuseExponent,this.config.diffuseExponent),this.setFogUniforms(this.shaderObjects),this.gl.uniform3f(this.shaderObjects.lightVector,this.pointLight[0],this.pointLight[1],this.pointLight[2]),this.setBaseShadowUniforms(this.shaderObjects,0,0,0,0,0,0,this.SCALE,this.SCALE,this.SCALE)}t||this.gl.uniform3fv(this.shaderObjects.colors,K),e.drawModel(this,this.fmCastleInner,0,0,0,0,0,0,this.SCALE,this.SCALE,this.SCALE),t||this.gl.uniform3fv(this.shaderObjects.colors,W),e.drawModel(this,this.fmCastleOuter,0,0,0,0,0,0,this.SCALE,this.SCALE,this.SCALE),t||this.gl.uniform3fv(this.shaderObjects.colors,X),e.drawModel(this,this.fmGround,0,0,0,0,0,0,this.SCALE,this.SCALE,this.SCALE),this.drawFlag(t,this.fmFlag1,-40,0,251,0,0,0,33,33,23,.4,.4,1),this.drawFlag(t,this.fmFlag1,-120,0,158,0,0,0,28,28,20,.4,.4,1);for(const[e,i,n]of this.smallFlags2)this.drawFlag(t,this.fmFlag2,-20*e,-20*n,20*i+14,0,0,0,18,20,10,.85,.85,.35);for(const[e,i,n]of this.smallFlags3)this.drawFlag(t,this.fmFlag3,-20*e,-20*n,20*i+14,0,0,0,18,20,10,.55,.2,.55);this.drawEagles(t),this.drawKnights(t)}drawKnights(t){this.drawWalkingKnight(t,Q,this.timers.get(ht.Spline2),0),this.drawWalkingKnight(t,tt,this.timers.get(ht.Spline3),0),this.drawWalkingKnight(t,et,this.timers.get(ht.Spline1),0),this.drawWalkingKnight(t,it,this.timers.get(ht.Spline3),0),this.drawWalkingKnight(t,nt,this.timers.get(ht.Spline3),0),this.drawWalkingKnight(t,rt,this.timers.get(ht.Spline1),0),this.drawWalkingKnight(t,rt,this.timers.get(ht.Spline1)+.5,0),this.drawTalkingNearSwordsKnights(t),this.drawKnightRepairingCart(t),this.drawKnightsNearCannons(t),this.drawKnightsAboveEntrance(t)}drawWind(){var t;void 0!==this.shaderWind&&(this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),this.gl.disable(this.gl.CULL_FACE),null===(t=this.shaderWind)||void 0===t||t.use(),this.gl.uniform2f(this.shaderWind.dimensions,98,.07),this.gl.uniform3f(this.shaderWind.amplitudes,.6,.4,1.2),this.gl.uniform3f(this.shaderWind.frequencies,.032,.05,.02),this.gl.uniform1f(this.shaderWind.fogStartDistance,this.fogStartDistance),this.gl.uniform1f(this.shaderWind.fogDistance,this.fogDistance),this.drawWindBatch(this.timers.get(ht.WindMove1),.36,this.randomWindCoeff1,80),this.drawWindBatch(this.timers.get(ht.WindMove2),.37,this.randomWindCoeff2,100),this.drawWindBatch(this.timers.get(ht.WindMove3),.38,this.randomWindCoeff3,170),this.gl.disable(this.gl.BLEND),this.gl.enable(this.gl.CULL_FACE))}drawWindBatch(t,e,i,n){if(void 0!==this.shaderWind)for(let r=0;r<3;r++){const o=(t+r*e)%1,s=.12*Math.pow(Math.sin(o*Math.PI),2),a=18*r-26+18*i,h=4.4*o*50*4/10;this.gl.uniform4f(this.shaderWind.color,s,s,s,1),this.gl.uniform3f(this.shaderWind.offset,a,10*h,0),this.shaderWind.draw(this,0,-500,n,0,0,0,10,1,10,50)}}getTimeOfDayBaseColor(){return $[this.config.timeOfDay]}getTimeOfDayAmbientCoeff(){return Y[this.config.timeOfDay]}getAmbientColor(){const t=this.getTimeOfDayBaseColor(),e=this.getTimeOfDayAmbientCoeff();return this.tempAmbient[0]=.5*e+.5*t[0]*e,this.tempAmbient[1]=.5*e+.5*t[1]*e,this.tempAmbient[2]=.5*e+.5*t[2]*e,this.tempAmbient}getDiffuseColor(){const t=this.getTimeOfDayBaseColor(),{diffuse:e}=this.config;return this.tempDiffuse[0]=.5*e+.5*t[0],this.tempDiffuse[1]=.5*e+.5*t[1],this.tempDiffuse[2]=.5*e+.5*t[2],this.tempDiffuse}getFogColor(){const t=this.getTimeOfDayBaseColor(),{fogColor:e}=this.config;return this.tempFog[0]=.5*e[0]+.5*t[0],this.tempFog[1]=.5*e[1]+.5*t[1],this.tempFog[2]=.5*e[2]+.5*t[2],this.tempFog}drawEagles(t){const e=this.timers.get(ht.BirdsFly)*Math.PI*2,i=this.getBirdPosition(e,80,-50),n=this.getBirdPosition(-e-Math.PI,0,0),r=this.getBirdPosition(-e-Math.PI,0,200),o=this.getBirdPosition(e,80,170),s=this.getBirdPosition(-e-Math.PI,100,180),a=this.getBirdPosition(e,-100,200);this.drawEagle(t,0,i.x,i.y,140,0,0,-e),this.drawEagle(t,1,n.x,n.y,190,0,0,e),this.drawEagle(t,2,r.x,r.y,150,0,0,e),this.drawEagle(t,3,o.x,o.y,160,0,0,-e),this.drawEagle(t,4,s.x,s.y,180,0,0,e),this.drawEagle(t,5,a.x,a.y,170,0,0,-e)}drawFlag(t,e,i,n,r,o,s,a,h,l,d,m,c,f){if(void 0===this.shaderFlag||void 0===this.shaderFlagDepth)return;const u=this.getDiffuseColor(),g=this.getAmbientColor();let _;t?(_=this.shaderFlagDepth,this.shaderFlagDepth.use(),this.gl.uniform1f(this.shaderFlagDepth.time,2*Math.PI*(1-this.timers.get(ht.Flags))),this.gl.uniform1f(this.shaderFlagDepth.amplitude,this.config.flagsAmplitude),this.gl.uniform1f(this.shaderFlagDepth.waves,this.config.flagsWaves)):(_=this.shaderFlag,this.shaderFlag.use(),this.gl.uniform1f(this.shaderFlag.time,2*Math.PI*(1-this.timers.get(ht.Flags))),this.gl.uniform1f(this.shaderFlag.amplitude,this.config.flagsAmplitude),this.gl.uniform1f(this.shaderFlag.waves,this.config.flagsWaves),this.gl.uniform4f(this.shaderFlag.lightDir,this.pointLight[0],this.pointLight[1],this.pointLight[2],0),this.gl.uniform4fv(this.shaderFlag.ambient,g),this.gl.uniform4fv(this.shaderFlag.diffuse,u),this.gl.uniform1f(this.shaderFlag.diffuseCoef,this.config.diffuseCoeff),this.gl.uniform1f(this.shaderFlag.diffuseExponent,this.config.diffuseExponent),this.setFogUniforms(this.shaderFlag),this.gl.uniform3f(this.shaderFlag.lightVector,this.pointLight[0],this.pointLight[1],this.pointLight[2]),this.gl.uniform4fv(this.shaderFlag.color,[m,c,f,1]),this.setBaseShadowUniforms(this.shaderFlag,i,n,r,o,s,a,h,l,d)),_.drawModel(this,e,i,n,r,o,s,a,h,l,d)}drawTalkingNearSwordsKnights(t){const e=.1*Math.sin(this.timers.get(ht.HeadAnimation1)*Math.PI*2)-.5,i=.1*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2),n=.1*-Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2)+1.5,r=.1*Math.sin(this.timers.get(ht.HeadAnimation1)*Math.PI*2+1)+.4,o=.1*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2),s=.1*-Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2)+1.45;this.drawKnight(t,e,i,n,-35,124,0,0,0,.15),this.drawKnight(t,r,o,s,-45,137,0,0,0,1.7)}drawKnightsNearCannons(t){const e=.07*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2)+.9,i=.05*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2)+.4,n=.05*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2)-1.9,r=.08*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2)+1.9,o=.08*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2+1)+1.9;this.drawKnight(t,e,i,1.8,40,123,0,0,0,-3.3),this.drawKnight(t,n,r,o,49,142,0,0,0,-3)}drawKnightsAboveEntrance(t){const e=.04*Math.sin(this.timers.get(ht.HeadAnimation1)*Math.PI*2)+.1,i=.09*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2),n=.09*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2+1),r=.04*Math.sin(this.timers.get(ht.HeadAnimation1)*Math.PI*2)-.1,o=.09*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2),s=.09*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2+1),a=.04*Math.sin(this.timers.get(ht.HeadAnimation1)*Math.PI*2)-.1,h=.1*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2+1)+.5;this.drawKnight(t,e,i,n,-30,-102,20,0,0,1.6),this.drawKnight(t,r,o,s,30,-102,20,0,0,.6),this.drawKnight(t,a,h,2,83,-65,20,0,.13,2.6),this.drawKnight(t,a,2,h,136,0,20,0,.13,3.6)}drawKnightRepairingCart(t){const e=.04*Math.sin(this.timers.get(ht.HeadAnimation1)*Math.PI*2+1)+.2,i=.3*Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2+2)+2,n=.3*-Math.sin(this.timers.get(ht.ArmsAnimation2)*Math.PI*2)+2;this.drawKnight(t,e,i,n,-41,234,0,.26,0,1.1)}drawWalkingKnight(t,e,i,n){i>1&&(i-=1);const r=.2*Math.sin(this.timers.get(ht.HeadAnimation1)*Math.PI*2+n),o=.5*Math.sin(this.timers.get(ht.ArmsAnimation1)*Math.PI*2+n),s=.5*-Math.sin(this.timers.get(ht.ArmsAnimation1)*Math.PI*2+n),a=1.2*Math.abs(Math.sin(this.timers.get(ht.Step1)*Math.PI*2+n)),h=e.getCurrentPoint(i);let l=e.getRotation(i).z;l*=.0174533,this.drawKnight(t,r,o,s,h.y,h.x,h.z+a,0,0,l)}drawKnight(t,e,i,n,r,o,s,a,h,l){if(void 0===this.shaderKnight||void 0===this.shaderKnightDepth)return;const d=this.getDiffuseColor(),m=this.getAmbientColor(),c=1.6;let f;t?(f=this.shaderKnightDepth,this.shaderKnightDepth.use(),this.gl.uniform1f(this.shaderKnightDepth.headRotationZ,e),this.gl.uniform2f(this.shaderKnightDepth.armRotations,i,n)):(f=this.shaderKnight,this.shaderKnight.use(),this.gl.uniform4f(this.shaderKnight.lightDir,this.pointLight[0],this.pointLight[1],this.pointLight[2],0),this.gl.uniform4fv(this.shaderKnight.ambient,m),this.gl.uniform4fv(this.shaderKnight.diffuse,d),this.gl.uniform1f(this.shaderKnight.diffuseCoef,this.config.diffuseCoeff),this.gl.uniform1f(this.shaderKnight.diffuseExponent,this.config.diffuseExponent),this.setFogUniforms(this.shaderKnight),this.gl.uniform3f(this.shaderKnight.lightVector,this.pointLight[0],this.pointLight[1],this.pointLight[2]),this.setTexture2D(1,this.textureKnight,this.shaderKnight.sTexture),this.gl.uniform1f(this.shaderKnight.headRotationZ,e),this.gl.uniform2f(this.shaderKnight.armRotations,i,n),this.setBaseShadowUniforms(this.shaderKnight,r,o,s,a,h,l,c,c,c)),f.drawModel(this,this.fmKnight,r,o,s,a,h,l,c,c,c)}getBirdPosition(t,e,i){return{x:Math.sin(t)*this.BIRD_FLIGHT_RADIUS+e,y:Math.cos(t)*this.BIRD_FLIGHT_RADIUS+i}}drawEagle(t,e,i,n,r,o,s,a){if(void 0===this.shaderEagle||void 0===this.shaderEagleDepth)return;const h=this.getDiffuseColor(),l=this.getAmbientColor(),d=.13;let m;const c=.4*Math.sin(this.timers.get(ht.Wings)*Math.PI*2+e);t?(m=this.shaderEagleDepth,this.shaderEagleDepth.use(),this.gl.uniform1f(this.shaderEagleDepth.wingsRotation,c)):(m=this.shaderEagle,this.shaderEagle.use(),this.gl.uniform4f(this.shaderEagle.lightDir,this.pointLight[0],this.pointLight[1],this.pointLight[2],0),this.gl.uniform4fv(this.shaderEagle.ambient,l),this.gl.uniform4fv(this.shaderEagle.diffuse,h),this.gl.uniform1f(this.shaderEagle.diffuseCoef,this.config.diffuseCoeff),this.gl.uniform1f(this.shaderEagle.diffuseExponent,this.config.diffuseExponent),this.setFogUniforms(this.shaderEagle),this.gl.uniform3f(this.shaderEagle.lightVector,this.pointLight[0],this.pointLight[1],this.pointLight[2]),this.gl.uniform1f(this.shaderEagle.wingsRotation,c),this.setTexture2D(1,this.textureEagle,this.shaderEagle.sTexture),this.setBaseShadowUniforms(this.shaderEagle,i,n,r,o,s,a,d,d,d)),m.drawModel(this,this.fmEagle,i,n,r,o,s,a,d,d,d)}get fogStartDistance(){return this.config.fogStartDistance*this.timers.get(ht.Fade)}get fogDistance(){return this.config.fogDistance*this.timers.get(ht.Fade)}setFogUniforms(t){const e=this.getFogColor();this.gl.uniform4fv(t.fogColor,e),this.gl.uniform1f(t.fogStartDistance,this.fogStartDistance),this.gl.uniform1f(t.fogDistance,this.fogDistance)}setBaseShadowUniforms(t,e,i,n,r,o,s,a,h,l){this.setTexture2D(0,this.textureOffscreenDepth,t.sDepth),this.gl.uniform1f(t.texelSize,1/this.SHADOWMAP_SIZE*this.SHADOWMAP_TEXEL_OFFSET_SCALE),this.gl.uniformMatrix4fv(t.projectionMatrix,!1,this.mProjMatrixLight),this.calculateMVPMatrix(e,i,n,r,o,s,a,h,l),this.gl.uniformMatrix4fv(t.modelMatrix,!1,this.mMMatrix),this.gl.uniformMatrix4fv(t.lightMatrix,!1,this.mViewMatrixLight,0),this.gl.uniform1f(t.shadowBrightnessFS,this.config.shadowBrightness),this.gl.uniform1f(t.pcfBiasCorrection,this.PCF_BIAS_CORRECTION)}setCameraMode(t){var e,i,n,r,o,s,a,h;t===A.Orbiting?(null===(e=this.orbitControls)||void 0===e||e.enable(),null===(i=this.freeMovement)||void 0===i||i.disable()):t===A.FPS?(null===(n=this.freeMovement)||void 0===n||n.updatePosition([0,-400,150]),null===(r=this.freeMovement)||void 0===r||r.updateRotation([.39,0,0]),null===(o=this.orbitControls)||void 0===o||o.disable(),null===(s=this.freeMovement)||void 0===s||s.enable()):(null===(a=this.orbitControls)||void 0===a||a.disable(),null===(h=this.freeMovement)||void 0===h||h.disable()),this.cameraMode=t}get currentCameraMode(){return this.cameraMode}checkGlError(t){}set ready(t){this.readyCallback=t}getProjMatrix(){return this.mProjMatrix}getCameraPosition(){return this.cameraPosition}getCanvas(){return this.canvas}createDepthTexture(t,e,i){const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_FUNC,t.LEQUAL);const r=t.getParameter(t.VERSION)||"",o=t.DEPTH_COMPONENT,s=r.includes("WebGL 2")?t.DEPTH_COMPONENT16:t.DEPTH_COMPONENT,a=t.UNSIGNED_SHORT;return t.texImage2D(t.TEXTURE_2D,0,s,e,i,0,o,a,null),n}initOffscreen(){void 0!==this.textureOffscreenDepth&&this.gl.deleteTexture(this.textureOffscreenDepth),void 0!==this.textureOffscreenColor&&this.gl.deleteTexture(this.textureOffscreenColor),this.textureOffscreenColor=class{static createNpotTexture(t,e,i,n=!1){const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);let o=null,s=null;return n?(o=t.RGBA,s=t.RGBA):(o=t.RGB,s=t.RGB),t.texImage2D(t.TEXTURE_2D,0,s,e,i,0,o,t.UNSIGNED_BYTE,null),r}static createDepthTexture(t,e,i){const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const r=t.getParameter(t.VERSION)||"",o=t.DEPTH_COMPONENT,s=r.includes("WebGL 2")?t.DEPTH_COMPONENT16:t.DEPTH_COMPONENT,a=t.UNSIGNED_SHORT;return t.texImage2D(t.TEXTURE_2D,0,s,e,i,0,o,a,null),n}}.createNpotTexture(this.gl,this.SHADOWMAP_SIZE,this.SHADOWMAP_SIZE,!1),this.checkGlError("color"),this.textureOffscreenDepth=this.createDepthTexture(this.gl,this.SHADOWMAP_SIZE,this.SHADOWMAP_SIZE),this.checkGlError("depth"),this.fboOffscreen=new c(this.gl),this.fboOffscreen.textureHandle=this.textureOffscreenColor,this.fboOffscreen.depthTextureHandle=this.textureOffscreenDepth,this.fboOffscreen.width=this.SHADOWMAP_SIZE,this.fboOffscreen.height=this.SHADOWMAP_SIZE,this.fboOffscreen.createGLData(this.SHADOWMAP_SIZE,this.SHADOWMAP_SIZE),this.checkGlError("offscreen FBO"),console.log("Initialized offscreen FBO.")}initVignette(){y(this.matOrtho,-1,1,-1,1,2,250),this.mQuadTriangles=new Float32Array([-1,-1,-5,0,0,1,-1,-5,1,0,-1,1,-5,0,1,1,1,-5,1,1]),this.mTriangleVerticesVignette=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.mTriangleVerticesVignette),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.mQuadTriangles,this.gl.STATIC_DRAW)}logCamera(){const t=ot[0];console.log(`\n        {\n            start: {\n                position: new Float32Array([${t.start.position.toString()}]),\n                rotation: new Float32Array([${t.start.rotation.toString()}])\n            },\n            end: {\n                position: new Float32Array([${t.end.position.toString()}]),\n                rotation: new Float32Array([${t.end.rotation.toString()}])\n            },\n            speedMultiplier: 1.0\n        },\n        `)}randomizeCamera(){this.currentRandomCamera=(this.currentRandomCamera+1+Math.trunc(Math.random()*(ot.length-2)))%ot.length,this.cameraPositionInterpolator.speed=this.CAMERA_SPEED*ot[this.currentRandomCamera].speedMultiplier,this.cameraPositionInterpolator.position=ot[this.currentRandomCamera],this.cameraPositionInterpolator.reset(),this.currentLightDirection=Math.random()*Math.PI*2,this.randomWindCoeff1=Math.random(),this.randomWindCoeff2=Math.random(),this.randomWindCoeff3=Math.random()}updateShadowResolution(t){this.SHADOWMAP_SIZE=1024*t,this.PCF_BIAS_CORRECTION=1.5/this.SHADOWMAP_SIZE,this.initOffscreen()}}function gt(t,e){var i=t.__state.conversionName.toString(),n=Math.round(t.r),r=Math.round(t.g),o=Math.round(t.b),s=t.a,a=Math.round(t.h),h=t.s.toFixed(1),l=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var d=t.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===i?"rgb("+n+","+r+","+o+")":"CSS_RGBA"===i?"rgba("+n+","+r+","+o+","+s+")":"HEX"===i?"0x"+t.hex.toString(16):"RGB_ARRAY"===i?"["+n+","+r+","+o+"]":"RGBA_ARRAY"===i?"["+n+","+r+","+o+","+s+"]":"RGB_OBJ"===i?"{r:"+n+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===i?"{r:"+n+",g:"+r+",b:"+o+",a:"+s+"}":"HSV_OBJ"===i?"{h:"+a+",s:"+h+",v:"+l+"}":"HSVA_OBJ"===i?"{h:"+a+",s:"+h+",v:"+l+",a:"+s+"}":"unknown format"}var _t=Array.prototype.forEach,pt=Array.prototype.slice,vt={BREAK:{},extend:function(t){return this.each(pt.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(e[i])||(t[i]=e[i])}.bind(this))}),this),t},defaults:function(t){return this.each(pt.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(t[i])&&(t[i]=e[i])}.bind(this))}),this),t},compose:function(){var t=pt.call(arguments);return function(){for(var e=pt.call(arguments),i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},each:function(t,e,i){if(t)if(_t&&t.forEach&&t.forEach===_t)t.forEach(e,i);else if(t.length===t.length+0){var n,r=void 0;for(r=0,n=t.length;r<n;r++)if(r in t&&e.call(i,t[r],r)===this.BREAK)return}else for(var o in t)if(e.call(i,t[o],o)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var n=void 0;return function(){var r=this,o=arguments;function s(){n=null,i||t.apply(r,o)}var a=i||!n;clearTimeout(n),n=setTimeout(s,e),a&&t.apply(r,o)}},toArray:function(t){return t.toArray?t.toArray():pt.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},xt=[{litmus:vt.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:gt},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:gt},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:gt},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:gt}}},{litmus:vt.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:vt.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:vt.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(vt.isNumber(t.r)&&vt.isNumber(t.g)&&vt.isNumber(t.b)&&vt.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(vt.isNumber(t.r)&&vt.isNumber(t.g)&&vt.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(vt.isNumber(t.h)&&vt.isNumber(t.s)&&vt.isNumber(t.v)&&vt.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(vt.isNumber(t.h)&&vt.isNumber(t.s)&&vt.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],Et=void 0,bt=void 0,wt=function(){bt=!1;var t=arguments.length>1?vt.toArray(arguments):arguments[0];return vt.each(xt,(function(e){if(e.litmus(t))return vt.each(e.conversions,(function(e,i){if(Et=e.read(t),!1===bt&&!1!==Et)return bt=Et,Et.conversionName=i,Et.conversion=e,vt.BREAK})),vt.BREAK})),bt},At=void 0,yt={hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),o=i*(1-e),s=i*(1-r*e),a=i*(1-(1-r)*e),h=[[i,a,o],[s,i,o],[o,i,a],[o,s,i],[a,o,i],[i,o,s]][n];return{r:255*h[0],g:255*h[1],b:255*h[2]}},rgb_to_hsv:function(t,e,i){var n=Math.min(t,e,i),r=Math.max(t,e,i),o=r-n,s=void 0;return 0===r?{h:NaN,s:0,v:0}:(s=t===r?(e-i)/o:e===r?2+(i-t)/o:4+(t-e)/o,(s/=6)<0&&(s+=1),{h:360*s,s:o/r,v:r/255})},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,i){return i<<(At=8*e)|t&~(255<<At)}},Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Tt=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Rt=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(n):void 0},St=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Ft=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Pt=function(){function t(){if(Mt(this,t),this.__state=wt.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Tt(t,[{key:"toString",value:function(){return gt(this)}},{key:"toHexString",value:function(){return gt(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function Dt(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||Pt.recalculateRGB(this,e,i),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(Pt.recalculateRGB(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function Ot(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||Pt.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(Pt.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}Pt.recalculateRGB=function(t,e,i){if("HEX"===t.__state.space)t.__state[e]=yt.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");vt.extend(t.__state,yt.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},Pt.recalculateHSV=function(t){var e=yt.rgb_to_hsv(t.r,t.g,t.b);vt.extend(t.__state,{s:e.s,v:e.v}),vt.isNaN(e.h)?vt.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},Pt.COMPONENTS=["r","g","b","h","s","v","hex","a"],Dt(Pt.prototype,"r",2),Dt(Pt.prototype,"g",1),Dt(Pt.prototype,"b",0),Ot(Pt.prototype,"h"),Ot(Pt.prototype,"s"),Ot(Pt.prototype,"v"),Object.defineProperty(Pt.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(Pt.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=yt.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var It=function(){function t(e,i){Mt(this,t),this.initialValue=e[i],this.domElement=document.createElement("div"),this.object=e,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return Tt(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),Lt={};vt.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){vt.each(t,(function(t){Lt[t]=e}))}));var Nt=/(\d+(\.\d+)?)px/;function Ut(t){if("0"===t||vt.isUndefined(t))return 0;var e=t.match(Nt);return vt.isNull(e)?0:parseFloat(e[1])}var Vt={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,i){var n=i,r=e;vt.isUndefined(r)&&(r=!0),vt.isUndefined(n)&&(n=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,i,n){var r=i||{},o=Lt[e];if(!o)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var a=r.x||r.clientX||0,h=r.y||r.clientY||0;s.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,a,h,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=s.initKeyboardEvent||s.initKeyEvent;vt.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:s.initEvent(e,r.bubbles||!1,r.cancelable||!0)}vt.defaults(s,n),t.dispatchEvent(s)},bind:function(t,e,i,n){var r=n||!1;return t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on"+e,i),Vt},unbind:function(t,e,i,n){var r=n||!1;return t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on"+e,i),Vt},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);-1===i.indexOf(e)&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Vt},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),n=i.indexOf(e);-1!==n&&(i.splice(n,1),t.className=i.join(" "))}else t.className=void 0;return Vt},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return Ut(e["border-left-width"])+Ut(e["border-right-width"])+Ut(e["padding-left"])+Ut(e["padding-right"])+Ut(e.width)},getHeight:function(t){var e=getComputedStyle(t);return Ut(e["border-top-width"])+Ut(e["border-bottom-width"])+Ut(e["padding-top"])+Ut(e["padding-bottom"])+Ut(e.height)},getOffset:function(t){var e=t,i={left:0,top:0};if(e.offsetParent)do{i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent}while(e);return i},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},Bt=function(t){function e(t,i){Mt(this,e);var n=Ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),Vt.bind(n.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return St(e,It),Tt(e,[{key:"setValue",value:function(t){var i=Rt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Rt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),kt=function(t){function e(t,i,n){Mt(this,e);var r=Ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=n,s=r;if(r.__select=document.createElement("select"),vt.isArray(o)){var a={};vt.each(o,(function(t){a[t]=t})),o=a}return vt.each(o,(function(t,e){var i=document.createElement("option");i.innerHTML=e,i.setAttribute("value",t),s.__select.appendChild(i)})),r.updateDisplay(),Vt.bind(r.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),r.domElement.appendChild(r.__select),r}return St(e,It),Tt(e,[{key:"setValue",value:function(t){var i=Rt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return Vt.isActive(this.__select)?this:(this.__select.value=this.getValue(),Rt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),Ht=function(t){function e(t,i){Mt(this,e);var n=Ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;function o(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),Vt.bind(n.__input,"keyup",o),Vt.bind(n.__input,"change",o),Vt.bind(n.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),Vt.bind(n.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return St(e,It),Tt(e,[{key:"updateDisplay",value:function(){return Vt.isActive(this.__input)||(this.__input.value=this.getValue()),Rt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function zt(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var jt=function(t){function e(t,i,n){Mt(this,e);var r=Ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=n||{};return r.__min=o.min,r.__max=o.max,r.__step=o.step,vt.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=zt(r.__impliedStep),r}return St(e,It),Tt(e,[{key:"setValue",value:function(t){var i=t;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),Rt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=zt(t),this}}]),e}();var Gt=function(t){function e(t,i,n){Mt(this,e);var r=Ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));r.__truncationSuspended=!1;var o=r,s=void 0;function a(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function h(t){var e=s-t.clientY;o.setValue(o.getValue()+e*o.__impliedStep),s=t.clientY}function l(){Vt.unbind(window,"mousemove",h),Vt.unbind(window,"mouseup",l),a()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),Vt.bind(r.__input,"change",(function(){var t=parseFloat(o.__input.value);vt.isNaN(t)||o.setValue(t)})),Vt.bind(r.__input,"blur",(function(){a()})),Vt.bind(r.__input,"mousedown",(function(t){Vt.bind(window,"mousemove",h),Vt.bind(window,"mouseup",l),s=t.clientY})),Vt.bind(r.__input,"keydown",(function(t){13===t.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,a())})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return St(e,jt),Tt(e,[{key:"updateDisplay",value:function(){var t,i,n;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),i=this.__precision,n=Math.pow(10,i),Math.round(t*n)/n),Rt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function Xt(t,e,i,n,r){return n+(t-e)/(i-e)*(r-n)}var Wt=function(t){function e(t,i,n,r,o){Mt(this,e);var s=Ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:n,max:r,step:o})),a=s;function h(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(Xt(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function l(){Vt.unbind(window,"mousemove",h),Vt.unbind(window,"mouseup",l),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function d(t){var e=t.touches[0].clientX,i=a.__background.getBoundingClientRect();a.setValue(Xt(e,i.left,i.right,a.__min,a.__max))}function m(){Vt.unbind(window,"touchmove",d),Vt.unbind(window,"touchend",m),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),Vt.bind(s.__background,"mousedown",(function(t){document.activeElement.blur(),Vt.bind(window,"mousemove",h),Vt.bind(window,"mouseup",l),h(t)})),Vt.bind(s.__background,"touchstart",(function(t){if(1!==t.touches.length)return;Vt.bind(window,"touchmove",d),Vt.bind(window,"touchend",m),d(t)})),Vt.addClass(s.__background,"slider"),Vt.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return St(e,jt),Tt(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",Rt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),Kt=function(t){function e(t,i,n){Mt(this,e);var r=Ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,Vt.bind(r.__button,"click",(function(t){return t.preventDefault(),o.fire(),!1})),Vt.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return St(e,It),Tt(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),$t=function(t){function e(t,i){Mt(this,e);var n=Ft(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));n.__color=new Pt(n.getValue()),n.__temp=new Pt(0);var r=n;n.domElement=document.createElement("div"),Vt.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",Vt.bind(n.__input,"keydown",(function(t){13===t.keyCode&&m.call(this)})),Vt.bind(n.__input,"blur",m),Vt.bind(n.__selector,"mousedown",(function(){Vt.addClass(this,"drag").bind(window,"mouseup",(function(){Vt.removeClass(r.__selector,"drag")}))})),Vt.bind(n.__selector,"touchstart",(function(){Vt.addClass(this,"drag").bind(window,"touchend",(function(){Vt.removeClass(r.__selector,"drag")}))}));var o,s=document.createElement("div");function a(t){f(t),Vt.bind(window,"mousemove",f),Vt.bind(window,"touchmove",f),Vt.bind(window,"mouseup",l),Vt.bind(window,"touchend",l)}function h(t){u(t),Vt.bind(window,"mousemove",u),Vt.bind(window,"touchmove",u),Vt.bind(window,"mouseup",d),Vt.bind(window,"touchend",d)}function l(){Vt.unbind(window,"mousemove",f),Vt.unbind(window,"touchmove",f),Vt.unbind(window,"mouseup",l),Vt.unbind(window,"touchend",l),c()}function d(){Vt.unbind(window,"mousemove",u),Vt.unbind(window,"touchmove",u),Vt.unbind(window,"mouseup",d),Vt.unbind(window,"touchend",d),c()}function m(){var t=wt(this.value);!1!==t?(r.__color.__state=t,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function c(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__saturation_field.getBoundingClientRect(),i=t.touches&&t.touches[0]||t,n=i.clientX,o=i.clientY,s=(n-e.left)/(e.right-e.left),a=1-(o-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),r.__color.v=a,r.__color.s=s,r.setValue(r.__color.toOriginal()),!1}function u(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__hue_field.getBoundingClientRect(),i=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return i>1?i=1:i<0&&(i=0),r.__color.h=360*i,r.setValue(r.__color.toOriginal()),!1}return vt.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),vt.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),vt.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),vt.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),vt.extend(s.style,{width:"100%",height:"100%",background:"none"}),Zt(s,"top","rgba(0,0,0,0)","#000"),vt.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=n.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",vt.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),Vt.bind(n.__saturation_field,"mousedown",a),Vt.bind(n.__saturation_field,"touchstart",a),Vt.bind(n.__field_knob,"mousedown",a),Vt.bind(n.__field_knob,"touchstart",a),Vt.bind(n.__hue_field,"mousedown",h),Vt.bind(n.__hue_field,"touchstart",h),n.__saturation_field.appendChild(s),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return St(e,It),Tt(e,[{key:"updateDisplay",value:function(){var t=wt(this.getValue());if(!1!==t){var e=!1;vt.each(Pt.COMPONENTS,(function(i){if(!vt.isUndefined(t[i])&&!vt.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return e=!0,{}}),this),e&&vt.extend(this.__color.__state,t)}vt.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,n=255-i;vt.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Zt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),vt.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),e}(),Yt=["-moz-","-o-","-webkit-","-ms-",""];function Zt(t,e,i,n){t.style.background="",vt.each(Yt,(function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+i+" 0%, "+n+" 100%); "}))}var qt=function(t,e){var i=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var r=i.getElementsByTagName("head")[0];try{r.appendChild(n)}catch(t){}},Jt='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',Qt=function(t,e){var i=t[e];return vt.isArray(arguments[2])||vt.isObject(arguments[2])?new kt(t,e,arguments[2]):vt.isNumber(i)?vt.isNumber(arguments[2])&&vt.isNumber(arguments[3])?vt.isNumber(arguments[4])?new Wt(t,e,arguments[2],arguments[3],arguments[4]):new Wt(t,e,arguments[2],arguments[3]):vt.isNumber(arguments[4])?new Gt(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Gt(t,e,{min:arguments[2],max:arguments[3]}):vt.isString(i)?new Ht(t,e):vt.isFunction(i)?new Kt(t,e,""):vt.isBoolean(i)?new Bt(t,e):null};var te=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},ee=function(){function t(){Mt(this,t),this.backgroundElement=document.createElement("div"),vt.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Vt.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),vt.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;Vt.bind(this.backgroundElement,"click",(function(){e.hide()}))}return Tt(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),vt.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",Vt.unbind(t.domElement,"webkitTransitionEnd",e),Vt.unbind(t.domElement,"transitionend",e),Vt.unbind(t.domElement,"oTransitionEnd",e)};Vt.bind(this.domElement,"webkitTransitionEnd",e),Vt.bind(this.domElement,"transitionend",e),Vt.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Vt.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Vt.getHeight(this.domElement)/2+"px"}}]),t}(),ie=function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");qt(ie);var ne=function(){try{return!!window.localStorage}catch(t){return!1}}(),re=void 0,oe=!0,se=void 0,ae=!1,he=[],le=function t(e){var i=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Vt.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=vt.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=vt.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),vt.isUndefined(n.load)?n.load={preset:"Default"}:n.preset&&(n.load.preset=n.preset),vt.isUndefined(n.parent)&&n.hideable&&he.push(this),n.resizable=vt.isUndefined(n.parent)&&n.resizable,n.autoPlace&&vt.isUndefined(n.scrollable)&&(n.scrollable=!0);var r,o=ne&&"true"===localStorage.getItem(ge(this,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:n.load.preset},set:function(t){i.parent?i.getRoot().preset=t:n.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),i.revert()}},width:{get:function(){return n.width},set:function(t){n.width=t,Ee(i,t)}},name:{get:function(){return n.name},set:function(t){n.name=t,a&&(a.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?Vt.addClass(i.__ul,t.CLASS_CLOSED):Vt.removeClass(i.__ul,t.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return o},set:function(t){ne&&(o=t,t?Vt.bind(window,"unload",s):Vt.unbind(window,"unload",s),localStorage.setItem(ge(i,"isLocal"),t))}}}),vt.isUndefined(n.parent)){if(this.closed=n.closed||!1,Vt.addClass(this.domElement,t.CLASS_MAIN),Vt.makeSelectable(this.domElement,!1),ne&&o){i.useLocalStorage=!0;var h=localStorage.getItem(ge(this,"gui"));h&&(n.load=JSON.parse(h))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,Vt.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(Vt.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Vt.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Vt.bind(this.__closeButton,"click",(function(){i.closed=!i.closed}))}else{void 0===n.closed&&(n.closed=!0);var l=document.createTextNode(n.name);Vt.addClass(l,"controller-name"),a=de(i,l);Vt.addClass(this.__ul,t.CLASS_CLOSED),Vt.addClass(a,"title"),Vt.bind(a,"click",(function(t){return t.preventDefault(),i.closed=!i.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(vt.isUndefined(n.parent)&&(oe&&(se=document.createElement("div"),Vt.addClass(se,"dg"),Vt.addClass(se,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(se),oe=!1),se.appendChild(this.domElement),Vt.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Ee(i,n.width)),this.__resizeHandler=function(){i.onResizeDebounced()},Vt.bind(window,"resize",this.__resizeHandler),Vt.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Vt.bind(this.__ul,"transitionend",this.__resizeHandler),Vt.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&xe(this),s=function(){ne&&"true"===localStorage.getItem(ge(i,"isLocal"))&&localStorage.setItem(ge(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=s,n.parent||((r=i.getRoot()).width+=1,vt.defer((function(){r.width-=1})))};function de(t,e,i){var n=document.createElement("li");return e&&n.appendChild(e),i?t.__ul.insertBefore(n,i):t.__ul.appendChild(n),t.onResize(),n}function me(t){Vt.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&Vt.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function ce(t,e){var i=t.__preset_select[t.__preset_select.selectedIndex];i.innerHTML=e?i.value+"*":i.value}function fe(t,e){var i=t.getRoot(),n=i.__rememberedObjects.indexOf(e.object);if(-1!==n){var r=i.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},i.__rememberedObjectIndecesToControllers[n]=r),r[e.property]=e,i.load&&i.load.remembered){var o=i.load.remembered,s=void 0;if(o[t.preset])s=o[t.preset];else{if(!o.Default)return;s=o.Default}if(s[n]&&void 0!==s[n][e.property]){var a=s[n][e.property];e.initialValue=a,e.setValue(a)}}}}function ue(t,e,i,n){if(void 0===e[i])throw new Error('Object "'+e+'" has no property "'+i+'"');var r=void 0;if(n.color)r=new $t(e,i);else{var o=[e,i].concat(n.factoryArgs);r=Qt.apply(t,o)}n.before instanceof It&&(n.before=n.before.__li),fe(t,r),Vt.addClass(r.domElement,"c");var s=document.createElement("span");Vt.addClass(s,"property-name"),s.innerHTML=r.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(r.domElement);var h=de(t,a,n.before);return Vt.addClass(h,le.CLASS_CONTROLLER_ROW),r instanceof $t?Vt.addClass(h,"color"):Vt.addClass(h,Ct(r.getValue())),function(t,e,i){if(i.__li=e,i.__gui=t,vt.extend(i,{options:function(e){if(arguments.length>1){var n=i.__li.nextElementSibling;return i.remove(),ue(t,i.object,i.property,{before:n,factoryArgs:[vt.toArray(arguments)]})}if(vt.isArray(e)||vt.isObject(e)){var r=i.__li.nextElementSibling;return i.remove(),ue(t,i.object,i.property,{before:r,factoryArgs:[e]})}},name:function(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof Wt){var n=new Gt(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});vt.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=i[t],r=n[t];i[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(n,t),e.apply(i,t)}})),Vt.addClass(e,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof Gt){var r=function(e){if(vt.isNumber(i.__min)&&vt.isNumber(i.__max)){var n=i.__li.firstElementChild.firstElementChild.innerHTML,r=i.__gui.__listening.indexOf(i)>-1;i.remove();var o=ue(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return o.name(n),r&&o.listen(),o}return e};i.min=vt.compose(r,i.min),i.max=vt.compose(r,i.max)}else i instanceof Bt?(Vt.bind(e,"click",(function(){Vt.fakeEvent(i.__checkbox,"click")})),Vt.bind(i.__checkbox,"click",(function(t){t.stopPropagation()}))):i instanceof Kt?(Vt.bind(e,"click",(function(){Vt.fakeEvent(i.__button,"click")})),Vt.bind(e,"mouseover",(function(){Vt.addClass(i.__button,"hover")})),Vt.bind(e,"mouseout",(function(){Vt.removeClass(i.__button,"hover")}))):i instanceof $t&&(Vt.addClass(e,"color"),i.updateDisplay=vt.compose((function(t){return e.style.borderLeftColor=i.__color.toString(),t}),i.updateDisplay),i.updateDisplay());i.setValue=vt.compose((function(e){return t.getRoot().__preset_select&&i.isModified()&&ce(t.getRoot(),!0),e}),i.setValue)}(t,h,r),t.__controllers.push(r),r}function ge(t,e){return document.location.href+"."+e}function _e(t,e,i){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function pe(t,e){e.style.display=t.useLocalStorage?"block":"none"}function ve(t){var e=t.__save_row=document.createElement("li");Vt.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),Vt.addClass(e,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",Vt.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",Vt.addClass(n,"button"),Vt.addClass(n,"save");var r=document.createElement("span");r.innerHTML="New",Vt.addClass(r,"button"),Vt.addClass(r,"save-as");var o=document.createElement("span");o.innerHTML="Revert",Vt.addClass(o,"button"),Vt.addClass(o,"revert");var s=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?vt.each(t.load.remembered,(function(e,i){_e(t,i,i===t.preset)})):_e(t,"Default",!1),Vt.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(i),e.appendChild(n),e.appendChild(r),e.appendChild(o),ne){var a=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ge(0,"isLocal"))&&h.setAttribute("checked","checked"),pe(t,a),Vt.bind(h,"change",(function(){t.useLocalStorage=!t.useLocalStorage,pe(t,a)}))}var l=document.getElementById("dg-new-constructor");Vt.bind(l,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||re.hide()})),Vt.bind(i,"click",(function(){l.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),re.show(),l.focus(),l.select()})),Vt.bind(n,"click",(function(){t.save()})),Vt.bind(r,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),Vt.bind(o,"click",(function(){t.revert()}))}function xe(t){var e=void 0;function i(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function n(){Vt.removeClass(t.__closeButton,le.CLASS_DRAG),Vt.unbind(window,"mousemove",i),Vt.unbind(window,"mouseup",n)}function r(r){return r.preventDefault(),e=r.clientX,Vt.addClass(t.__closeButton,le.CLASS_DRAG),Vt.bind(window,"mousemove",i),Vt.bind(window,"mouseup",n),!1}t.__resize_handle=document.createElement("div"),vt.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Vt.bind(t.__resize_handle,"mousedown",r),Vt.bind(t.__closeButton,"mousedown",r),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function Ee(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function be(t,e){var i={};return vt.each(t.__rememberedObjects,(function(n,r){var o={},s=t.__rememberedObjectIndecesToControllers[r];vt.each(s,(function(t,i){o[i]=e?t.initialValue:t.getValue()})),i[r]=o})),i}function we(t){0!==t.length&&te.call(window,(function(){we(t)})),vt.each(t,(function(t){t.updateDisplay()}))}le.toggleHide=function(){ae=!ae,vt.each(he,(function(t){t.domElement.style.display=ae?"none":""}))},le.CLASS_AUTO_PLACE="a",le.CLASS_AUTO_PLACE_CONTAINER="ac",le.CLASS_MAIN="main",le.CLASS_CONTROLLER_ROW="cr",le.CLASS_TOO_TALL="taller-than-window",le.CLASS_CLOSED="closed",le.CLASS_CLOSE_BUTTON="close-button",le.CLASS_CLOSE_TOP="close-top",le.CLASS_CLOSE_BOTTOM="close-bottom",le.CLASS_DRAG="drag",le.DEFAULT_WIDTH=245,le.TEXT_CLOSED="Close Controls",le.TEXT_OPEN="Open Controls",le._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||le.toggleHide()},Vt.bind(window,"keydown",le._keydownHandler,!1),vt.extend(le.prototype,{add:function(t,e){return ue(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return ue(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;vt.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&se.removeChild(this.domElement);var t=this;vt.each(this.__folders,(function(e){t.removeFolder(e)})),Vt.unbind(window,"keydown",le._keydownHandler,!1),me(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new le(e);this.__folders[t]=i;var n=de(this,i.domElement);return Vt.addClass(n,"folder"),i},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],me(t);var e=this;vt.each(t.__folders,(function(e){t.removeFolder(e)})),vt.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=Vt.getOffset(t.__ul).top,i=0;vt.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(i+=Vt.getHeight(e))})),window.innerHeight-e-20<i?(Vt.addClass(t.domElement,le.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(Vt.removeClass(t.domElement,le.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&vt.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:vt.debounce((function(){this.onResize()}),50),remember:function(){if(vt.isUndefined(re)&&((re=new ee).domElement.innerHTML=Jt),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;vt.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&ve(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&Ee(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=be(this)),t.folders={},vt.each(this.__folders,(function(e,i){t.folders[i]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=be(this),ce(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=be(this,!0)),this.load.remembered[t]=be(this),this.preset=t,_e(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){vt.each(this.__controllers,(function(e){this.getRoot().load.remembered?fe(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),vt.each(this.__folders,(function(t){t.revert(t)})),t||ce(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&we(this.__listening)},updateDisplay:function(){vt.each(this.__controllers,(function(t){t.updateDisplay()})),vt.each(this.__folders,(function(t){t.updateDisplay()}))}});var Ae=le;let ye;var Ce;Ce=()=>{ye=new ut,ye.ready=()=>{!function(){var t,e;null===(t=document.getElementById("message"))||void 0===t||t.classList.add("hidden"),null===(e=document.getElementById("canvasGL"))||void 0===e||e.classList.remove("transparent"),setTimeout((()=>{var t;return null===(t=document.querySelector(".promo"))||void 0===t?void 0:t.classList.remove("transparent")}),4e3),setTimeout((()=>{var t;return null===(t=document.querySelector("#toggleFullscreen"))||void 0===t?void 0:t.classList.remove("transparent")}),1800);const i=new Ae,n={github:()=>window.open("https://github.com/keaukraine/webgl-stylized-castle")};i.add(ye.config,"timeOfDay",{Day:0,Night:1,Sunrise:2,Sunset:3}).name("Time of Day").onChange((t=>ye.config.timeOfDay=+t)),i.add(ye.config,"shadowResolution",{Ultra:4,High:3,Medium:2,Low:1}).name("Shadow resolution").onChange((t=>ye.updateShadowResolution(+t))),i.add(ye,"currentCameraMode",{Orbit:A.Orbiting,Cinematic:A.Random,Free:A.FPS}).name("Camera").onChange((t=>ye.setCameraMode(+t))),i.add(n,"github").name("Source at Github")}()},ye.init("canvasGL",!0);const e=new t;document.getElementById("toggleFullscreen").addEventListener("click",(()=>{document.body.classList.contains("fs")?e.exitFullScreen():e.enterFullScreen(),e.addFullScreenListener((function(){e.isFullScreen()?document.body.classList.add("fs"):document.body.classList.remove("fs")}))}))},"loading"!==document.readyState?Ce():document.addEventListener("DOMContentLoaded",Ce);
//# sourceMappingURL=index.min.js.map
